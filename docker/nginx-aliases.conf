# Common vhost aliases for webdevops/php-nginx

# Map admin/shop view public assets outside docroot
location ^~ /app/admin/view/public/ {
    alias /app/app/admin/view/public/;
}
location ^~ /app/shop/view/public/ {
    alias /app/app/shop/view/public/;
}
# Legacy without leading /app
location ^~ /admin/view/public/ {
    alias /app/app/admin/view/public/;
}
location ^~ /shop/view/public/ {
    alias /app/app/shop/view/public/;
}

# Uploads and addons from project root
location ^~ /upload/ {
    alias /app/upload/;
}
location ^~ /addon/ {
    alias /app/addon/;
}

# Compat: /static/layui/** -> /static/ext/layui/**
location ^~ /static/layui/ {
    alias /app/public/static/ext/layui/;
}

# ThinkPHP URL rewrite: support /module/controller/action.html
# When the request is not an existing file or directory,
# rewrite to index.php with s=$uri (ThinkPHP routing)
if (!-e $request_filename) {
    # 使用 PATH_INFO 形式传递路由，兼容 ThinkPHP 多应用
    rewrite ^\/(.*)$ \/index.php/$1 last;
}
# route handling使用默认vhost，以上重写已生效。