(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-152b89fb"],{"700f":function(t,e,a){"use strict";a("a868")},a868:function(t,e,a){},aa81:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ns-coupon"},[e("div",{staticClass:"ns-coupon-info"},[e("div",{staticClass:"ns-coupon-wrap"},[t._m(0),t._m(1),e("el-button",{on:{click:t.myCoupon}},[t._v("我的优惠券")])],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingAd,expression:"loadingAd"}],staticClass:"ns-coupon-img"},[e("el-carousel",{attrs:{height:"406px"}},t._l(t.adList,(function(a){return e("el-carousel-item",{key:a.adv_id},[e("el-image",{attrs:{src:t.$img(a.adv_image),fit:"cover"},on:{click:function(e){return t.$router.pushToTab(a.adv_url.url)}}})],1)})),1)],1)]),e("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"店铺优惠券",name:"first"}}),e("el-tab-pane",{attrs:{label:"平台优惠券",name:"second"}}),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("ul",{staticClass:"ns-coupon-list"},t._l(t.couponList,(function(a,i){return e("li",{key:i,staticClass:"ns-bg-color ns-coupon-li"},[e("div",{staticClass:"describe"},[[a.discount&&"0.00"!=a.discount?e("span",[t._v(t._s(a.discount)+"折")]):e("span",[t._v("￥"+t._s(a.money))])],e("span",[t._v(t._s("first"==t.activeName?a.coupon_name:a.platformcoupon_name))]),"first"==t.activeName?e("span",[t._v("使用店铺："+t._s(a.site_name))]):t._e(),["0.00"==a.at_least?e("span",[t._v("无门槛优惠券")]):e("span",[t._v("满"+t._s(a.at_least)+"可使用")])],[a.validity_type?e("span",{staticClass:"coupon-wrap-time"},[t._v("领取之日起"+t._s(a.fixed_term)+"日内有效")]):e("span",{staticClass:"coupon-wrap-time"},[t._v("有效期至"+t._s(t.$timeStampTurnTime(a.end_time)))])]],2),e("div",{staticClass:"receive"},[e("a",{staticClass:"ns-text-color",on:{click:function(e){return t.couponTap(a,i)}}},[0==a.useState?e("span",[t._v("立即领取")]):e("span",[t._v("去使用")])])])])})),0),t.couponList.length<=0?e("div",{staticClass:"empty-wrap"},[e("div",{staticClass:"ns-text-align"},[t._v("暂无优惠券")])]):t._e(),e("div",{staticClass:"pager"},[e("el-pagination",{attrs:{background:"","pager-count":5,total:t.total,"prev-text":"上一页","next-text":"下一页","current-page":t.currentPage,"page-size":t.pageSize,"hide-on-single-page":""},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"size-change":t.handlePageSizeChange,"current-change":t.handleCurrentPageChange}})],1)])],1)],1)},s=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"coupon-name"},[e("span",{staticClass:"ns-text-color"},[t._v("优惠券中心")]),e("span",{staticClass:"ns-text-color-gray text12"},[t._v("省钱更多，领券更多")])])},function(){var t=this,e=t._self._c;return e("ul",{staticClass:"coupon-type clear-float"},[e("li",[e("i"),e("span",[t._v("限时抢券")])]),e("li",[e("i"),e("span",[t._v("叠加使用")])]),e("li",[e("i"),e("span",[t._v("种类多样")])])])}],o=(a("14d9"),a("cbfe")),n=a("2f62"),c=a("37cb"),u={name:"coupon",components:{},data:()=>({couponList:[],total:0,currentPage:1,pageSize:9,couponBtnSwitch:!1,activeName:"first",loading:!0,loadingAd:!0,adList:[]}),created(){this.addonIsExit&&1!=this.addonIsExit.coupon?this.$message({message:"优惠券插件未安装",type:"warning",duration:2e3,onClose:()=>{this.$route.push("/")}}):(this.getAdList(),this.getCanReceiveCouponQuery())},computed:{...Object(n["b"])(["addonIsExit"])},watch:{addonIsExit(){1!=this.addonIsExit.coupon&&this.$message({message:"优惠券插件未安装",type:"warning",duration:2e3,onClose:()=>{this.$route.push("/")}})}},methods:{getAdList(){Object(c["a"])({keyword:"NS_PC_COUPON"}).then(t=>{this.adList=t.data.adv_list;for(let e=0;e<this.adList.length;e++)this.adList[e].adv_url&&(this.adList[e].adv_url=JSON.parse(this.adList[e].adv_url));this.loadingAd=!1}).catch(t=>{this.loadingAd=!1})},handleClick(t,e){this.loading=!0,this.currentPage=1,this.getCanReceiveCouponQuery()},myCoupon(){this.$router.pushToTab("/member/my_coupon")},getCanReceiveCouponQuery(){Object(o["a"])({page:this.currentPage,page_size:this.pageSize,activeName:this.activeName}).then(t=>{this.couponList=t.data.list,this.total=t.data.count,this.couponList.forEach(t=>{t.useState=0}),this.loading=!1}).catch(t=>{this.loading=!1,this.$message.error(t.message)})},handlePageSizeChange(t){this.pageSize=t,this.loading=!0,this.getCanReceiveCouponQuery()},handleCurrentPageChange(t){this.currentPage=t,this.loading=!0,this.getCanReceiveCouponQuery()},couponTap(t,e){0==t.useState?this.receiveCoupon(t,e):this.toGoodsList(t)},receiveCoupon(t,e){if(!this.couponBtnSwitch){this.couponBtnSwitch=!0;var a={site_id:t.site_id,activeName:this.activeName};"first"==this.activeName?a.coupon_type_id=t.coupon_type_id:a.platformcoupon_type_id=t.platformcoupon_type_id,Object(o["d"])(a).then(e=>{e.data;let a=e.message;0==e.code?(a="领取成功",this.$message({message:a,type:"success"})):this.$message({message:a,type:"warning"});let i=this.couponList;if(1==e.data.is_exist)for(let s=0;s<i.length;s++)"first"==this.activeName?i[s].coupon_type_id==t.coupon_type_id&&(i[s].useState=1):i[s].platformcoupon_type_id==t.platformcoupon_type_id&&(i[s].useState=1);else for(let s=0;s<i.length;s++)"first"==this.activeName?i[s].coupon_type_id==t.coupon_type_id&&(i[s].useState=2):i[s].platformcoupon_type_id==t.platformcoupon_type_id&&(i[s].useState=2);this.couponBtnSwitch=!1,this.$forceUpdate()}).catch(t=>{"token不存在"==t.message?this.$router.pushToTab("/login"):this.$message.error(t.message),this.couponBtnSwitch=!1})}},toGoodsList(t){"first"==this.activeName?1!=t.goods_type?this.$router.push({path:"/shop_list",query:{site_id:t.site_id,couponId:t.coupon_type_id}}):this.$router.push({path:"/shop_list",query:{site_id:t.site_id}}):1!=t.use_scenario?this.$router.push({path:"/list",query:{platformcouponTypeId:t.platformcoupon_type_id}}):this.$router.push("/list")}}},p=u,r=(a("700f"),a("2877")),l=Object(r["a"])(p,i,s,!1,null,"568b56a8",null);e["default"]=l.exports},cbfe:function(t,e,a){"use strict";a.d(e,"c",(function(){return s})),a.d(e,"b",(function(){return o})),a.d(e,"a",(function(){return n})),a.d(e,"d",(function(){return c}));var i=a("751a");function s(t){return Object(i["a"])({url:"/coupon/api/coupon/typelists",data:t})}function o(t){return Object(i["a"])({url:"/coupon/api/coupon/receive",data:t,forceLogin:!0})}function n(t){let e="";return e="first"==t.activeName?"/coupon/api/coupon/typepagelists":"/platformcoupon/api/platformcoupon/typepagelists",Object(i["a"])({url:e,data:t})}function c(t){let e="";return e="first"==t.activeName?"/coupon/api/coupon/receive":"/platformcoupon/api/platformcoupon/receive",Object(i["a"])({url:e,data:t,forceLogin:!0})}}}]);
//# sourceMappingURL=chunk-152b89fb.11f4d770.js.map