(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3aa44e94"],{"07ac":function(e,t,i){var s=i("23e7"),o=i("6f53").values;s({target:"Object",stat:!0},{values:function(e){return o(e)}})},"30b4":function(e,t,i){"use strict";i("d80c")},"65bb":function(e,t,i){},"6f53":function(e,t,i){var s=i("83ab"),o=i("df75"),a=i("fc6a"),r=i("d1e7").f,n=function(e){return function(t){var i,n=a(t),c=o(n),l=c.length,d=0,m=[];while(l>d)i=c[d++],s&&!r.call(n,i)||m.push(e?[i,n[i]]:n[i]);return m}};e.exports={entries:n(!0),values:n(!1)}},"79c2":function(e,t,i){"use strict";i("65bb")},"86bd":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:e.id,staticClass:"magnifier-box",class:e.vertical?"vertical":"",on:{mousemove:e.mousemove,mouseover:e.mouseover,mouseleave:e.mouseleave}},[i("img",{directives:[{name:"show",rawName:"v-show",value:e.showImg,expression:"showImg"}],attrs:{src:e.imgUrl,alt:""}}),i("div",{staticClass:"mouse-cover"}),e.showEidt?i("div",{staticClass:"edit-wrap"},[i("span",{staticClass:"rotate-left",on:{click:function(t){return e.rotate("left")}}}),i("span",{staticClass:"rotate-right",on:{click:function(t){return e.rotate("right")}}})]):e._e()])},o=[],a=(i("a9e3"),i("d3b7"),i("25f0"),{props:{scale:{type:Number,default:2.5},url:{type:String,required:!0},bigUrl:{type:String,default:null},scroll:{type:Boolean,default:!1},showEidt:{type:Boolean,default:!1}},data:function(){return{id:null,cover:null,imgbox:null,imgwrap:null,orginUrl:null,bigImgUrl:null,bigOrginUrl:null,imgUrl:null,img:null,canvas:null,ctx:null,rectTimesX:0,rectTimesY:0,imgTimesX:0,imgTimesY:0,init:!1,step:0,bigStep:0,vertical:!1,showImg:!0}},created:function(){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=e.length,i="",s=0;s<10;s++)i+=e.charAt(Math.floor(Math.random()*t));this.id=i,this.imgUrl=this.url,this.orginUrl=this.url,this.bigImgUrl=this.bigUrl,this.bigOrginUrl=this.bigUrl},watch:{url:function(e){this.imgUrl=e,this.orginUrl=e,this.initTime()},bigUrl:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.bigImgUrl=bigUrl,this.bigOrginUrl=bigUrl,this.initTime()}))},mounted:function(){var e=this;this.$nextTick((function(){e.initTime()}))},methods:{initTime:function(){var e=this;this.init=!1;var t,i=this.$refs[this.id];this.imgbox=i,this.cover=i.querySelector(".mouse-cover"),this.cover.style.width=this.imgbox.offsetWidth/this.scale+"px",this.cover.style.height=this.imgbox.offsetHeight/this.scale+"px",this.cover.style.left="-100%",this.cover.style.top="-100%",this.imgwrap=i.querySelector("img"),t=this.bigImgUrl?this.bigImgUrl:this.imgUrl,this.img=new Image,this.img.src=t,this.img.onload=function(){e.rectTimesX=e.imgbox.offsetWidth/e.scale/e.imgwrap.offsetWidth,e.rectTimesY=e.imgbox.offsetHeight/e.scale/e.imgwrap.offsetHeight,e.imgTimesX=e.img.width/e.imgwrap.offsetWidth,e.imgTimesY=e.img.height/e.imgwrap.offsetHeight,e.vertical=e.img.width<e.img.height,e.init=!0},this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.canvas=document.createElement("canvas"),this.canvas.className="mouse-cover-canvas",this.canvas.style.position="absolute",this.canvas.style.left=this.imgbox.offsetLeft+this.imgbox.offsetWidth+10+"px",this.canvas.style.top=this.imgbox.offsetTop+"px",this.canvas.style.border="1px solid #eee",this.canvas.style.zIndex="99999",this.canvas.height=this.imgbox.offsetHeight,this.canvas.width=this.imgbox.offsetWidth,this.canvas.style.display="none",document.body.append(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},initBox:function(){var e=this;this.showImg=!1,this.canvas.style.display="none";var t,i=this.$refs[this.id];t=this.bigImgUrl?this.bigImgUrl:this.imgUrl,this.img=new Image,this.img.src=t,this.img.onload=function(){e.vertical=e.img.width<e.img.height,e.showImg=!0;i.querySelector("img");setTimeout((function(){e.rectTimesX=e.imgbox.offsetWidth/e.scale/i.querySelector("img").offsetWidth,e.rectTimesY=e.imgbox.offsetHeight/e.scale/i.querySelector("img").offsetHeight}),20)}},mousemove:function(e){if(!this.init)return!1;var t=this;function i(e){var t=null,i=null,s=e.offsetParent;t+=e.offsetLeft,i+=e.offsetTop;while(s)-1===navigator.userAgent.indexOf("MSIE 8.0")&&(t+=s.clientLeft,i+=s.clientTop),t+=s.offsetLeft,i+=s.offsetTop,s=s.offsetParent;return{left:t,top:i}}function s(e){return{x:e.clientX-t.cover.offsetWidth/2,y:e.clientY-t.cover.offsetHeight/2}}var o=e||event,a=s(o),r=i(this.imgwrap),n={minX:r.left,maxX:r.left+this.imgwrap.offsetWidth-this.cover.offsetWidth,minY:r.top-document.documentElement.scrollTop,maxY:r.top-document.documentElement.scrollTop+this.imgwrap.offsetHeight-this.cover.offsetHeight};a.x>n.maxX&&(a.x=n.maxX),a.x<n.minX&&(a.x=n.minX),a.y>n.maxY&&(a.y=n.maxY),a.y<n.minY&&(a.y=n.minY),this.cover.style.left=a.x+"px",this.cover.style.top=a.y+"px",this.ctx.clearRect(0,0,this.imgwrap.offsetWidth,this.imgwrap.offsetHeight);var c=a.x-(r.left-document.documentElement.scrollLeft),l=a.y-(r.top-document.documentElement.scrollTop);this.ctx.drawImage(this.img,c*this.imgTimesX,l*this.imgTimesY,this.img.width*this.rectTimesX,this.img.height*this.rectTimesY,0,0,this.imgbox.offsetWidth,this.imgbox.offsetHeight)},mouseover:function(e){if(!this.init)return!1;e=e||event,this.scroll||(e.currentTarget.addEventListener("mousewheel",(function(e){e.preventDefault()}),!1),e.currentTarget.addEventListener("DOMMouseScroll",(function(e){e.preventDefault()}),!1)),this.cover.style.display="block",this.canvas.style.display="block"},mouseleave:function(){if(!this.init)return!1;this.cover.style.display="none",this.canvas.style.display="none"},rotate:function(e){var t=this,i=new Image;if(i.crossOrigin="Anonymous",i.src=this.orginUrl,i.onload=function(){t.rotateImg(i,e,t.step)},this.bigOrginUrl){var s=new Image;i.crossOrigin="Anonymous",s.src=this.bigOrginUrl,s.onload=function(){t.rotateImg(s,e,t.bigStep,!0)}}},rotateImg:function(e,t,i){var s=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=0,r=3;if(null!=e){var n=e.height,c=e.width;null==i&&(i=a),"right"==t?(i++,i>r&&(i=a)):(i--,i<a&&(i=r));var l=document.createElement("canvas"),d=90*i*Math.PI/180,m=l.getContext("2d");switch(l.width=n,l.height=c,m.rotate(d),m.drawImage(e,0,-n),i){case 0:l.width=c,l.height=n,m.drawImage(e,0,0);break;case 1:l.width=n,l.height=c,m.rotate(d),m.drawImage(e,0,-n);break;case 2:l.width=c,l.height=n,m.rotate(d),m.drawImage(e,-c,-n);break;case 3:l.width=n,l.height=c,m.rotate(d),m.drawImage(e,-c,0);break}var u=l.toDataURL();o?(this.bigImgUrl=u,this.bigStep=i,this.initBox()):(this.imgUrl=u,this.step=i,this.$nextTick((function(){s.initBox()})))}}}}),r=a,n=(i("79c2"),i("2877")),c=Object(n["a"])(r,s,o,!1,null,"69c01ff0",null);t["a"]=c.exports},8812:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.fullscreenLoading,expression:"fullscreenLoading"}]},[0==e.orderPaymentData.is_virtual?i("div",{staticClass:"item-block"},[i("div",{staticClass:"block-text"},[e._v("收货地址")]),i("div",{attrs:{clsas:"address-list"}},[i("div",{staticClass:"address-item",on:{click:e.addAddressShow}},[e._m(0)]),e._l(e.memberAddress,(function(t,s){return s<3||e.addressShow&&s>=3?i("div",{key:t.id,staticClass:"address-item",class:e.addressId==t.id?"active":""},[i("div",{staticClass:"address-info"},[i("div",{staticClass:"options"},[i("div",{on:{click:function(i){return e.editAddress(t.id)}}},[e._v("编辑")]),0==t.is_default?[i("el-popconfirm",{attrs:{title:"确定要删除该地址吗？"},on:{onConfirm:function(i){return e.deleteMemberAddress(t.id)}}},[i("div",{attrs:{slot:"reference"},slot:"reference"},[e._v("删除")])])]:e._e()],2),i("div",{staticClass:"address-name"},[e._v(e._s(t.name))]),i("div",{staticClass:"address-mobile",on:{click:function(i){return e.setMemberAddress(t.id)}}},[e._v(e._s(t.mobile))]),i("div",{staticClass:"address-desc",on:{click:function(i){return e.setMemberAddress(t.id)}}},[e._v(e._s(t.full_address)+" "+e._s(t.address))])])]):e._e()})),e.memberAddress.length>3&&!e.addressShow?i("div",{staticClass:"el-button--text address-open",on:{click:function(t){e.addressShow=!0}}},[i("i",{staticClass:"el-icon-arrow-down"}),e._v(" 更多收货地址 ")]):e._e(),i("div",{staticClass:"clear"})],2)]):e._e(),1==e.orderPaymentData.is_virtual?i("div",{staticClass:"item-block"},[i("div",{staticClass:"block-text"},[e._v("购买虚拟类商品需填写您的手机号，以方便商家与您联系")]),i("el-form",{ref:"form",staticClass:"mobile-wrap",attrs:{size:"mini","label-width":"80px"}},[i("el-form-item",{attrs:{label:"手机号码"}},[i("el-input",{attrs:{placeholder:"请输入您的手机号码",maxlength:"11"},model:{value:e.orderCreateData.member_address.mobile,callback:function(t){e.$set(e.orderCreateData.member_address,"mobile",t)},expression:"orderCreateData.member_address.mobile"}})],1)],1)],1):e._e(),i("el-dialog",{attrs:{title:0==e.addressForm.id?"添加收货地址":"编辑收货地址",visible:e.dialogVisible,width:"32%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"form",attrs:{rules:e.addressRules,model:e.addressForm,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"姓名",prop:"name"}},[i("el-input",{attrs:{placeholder:"收货人姓名"},model:{value:e.addressForm.name,callback:function(t){e.$set(e.addressForm,"name",t)},expression:"addressForm.name"}})],1),i("el-form-item",{attrs:{label:"手机",prop:"mobile"}},[i("el-input",{attrs:{maxlength:"11",placeholder:"收货人手机号"},model:{value:e.addressForm.mobile,callback:function(t){e.$set(e.addressForm,"mobile",t)},expression:"addressForm.mobile"}})],1),i("el-form-item",{attrs:{label:"电话"}},[i("el-input",{attrs:{placeholder:"收货人固定电话（选填）"},model:{value:e.addressForm.telephone,callback:function(t){e.$set(e.addressForm,"telephone",t)},expression:"addressForm.telephone"}})],1),i("el-form-item",{staticClass:"area",attrs:{label:"地区",prop:"area"}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:7}},[i("el-select",{ref:"province",attrs:{prop:"province",placeholder:"请选择省"},on:{change:function(t){return e.getAddress(1)}},model:{value:e.addressForm.province_id,callback:function(t){e.$set(e.addressForm,"province_id",t)},expression:"addressForm.province_id"}},[i("el-option",{attrs:{label:"请选择省",value:"0"}}),e._l(e.pickerValueArray,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],2)],1),i("el-col",{attrs:{span:7}},[i("el-select",{ref:"city",attrs:{prop:"city",placeholder:"请选择市"},on:{change:function(t){return e.getAddress(2)}},model:{value:e.addressForm.city_id,callback:function(t){e.$set(e.addressForm,"city_id",t)},expression:"addressForm.city_id"}},[i("el-option",{attrs:{label:"请选择市",value:"0"}}),e._l(e.cityArr,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],2)],1),i("el-col",{attrs:{span:7}},[i("el-select",{ref:"district",attrs:{prop:"district",placeholder:"请选择区/县"},model:{value:e.addressForm.district_id,callback:function(t){e.$set(e.addressForm,"district_id",t)},expression:"addressForm.district_id"}},[i("el-option",{attrs:{label:"请选择区/县",value:"0"}}),e._l(e.districtArr,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],2)],1)],1)],1),i("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[i("el-input",{attrs:{placeholder:"定位小区、街道、写字楼"},model:{value:e.addressForm.address,callback:function(t){e.$set(e.addressForm,"address",t)},expression:"addressForm.address"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addmemberAddress("form")}}},[e._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"添加发票信息",visible:e.invoiceVisible,width:"32%"},on:{"update:visible":function(t){e.invoiceVisible=t}}},[i("el-form",{ref:"invoiceForm",attrs:{model:e.invoiceForm,rules:e.invoiceRules,"label-width":"150px"}},[i("el-form-item",{attrs:{label:"发票类型",prop:"invoice_type"}},[i("el-radio-group",{model:{value:e.invoiceForm.invoice_type,callback:function(t){e.$set(e.invoiceForm,"invoice_type",t)},expression:"invoiceForm.invoice_type"}},e._l(e.paperData,(function(t,s){return i("el-radio",{key:s,attrs:{label:t.value}},[e._v(e._s(t.name))])})),1)],1),i("el-form-item",{attrs:{label:"发票抬头类型",prop:"invoice_title_type"}},[i("el-radio-group",{model:{value:e.invoiceForm.invoice_title_type,callback:function(t){e.$set(e.invoiceForm,"invoice_title_type",t)},expression:"invoiceForm.invoice_title_type"}},e._l(e.enterpriseData,(function(t,s){return i("el-radio",{key:s,attrs:{label:t.value}},[e._v(e._s(t.name))])})),1)],1),i("el-form-item",{attrs:{label:"请填写抬头名称",prop:"invoice_title"}},[i("el-input",{model:{value:e.invoiceForm.invoice_title,callback:function(t){e.$set(e.invoiceForm,"invoice_title",t)},expression:"invoiceForm.invoice_title"}})],1),2==e.invoiceForm.invoice_title_type?i("el-form-item",{attrs:{label:"请填写纳税人识别号",prop:"taxpayer_number"}},[i("el-input",{model:{value:e.invoiceForm.taxpayer_number,callback:function(t){e.$set(e.invoiceForm,"taxpayer_number",t)},expression:"invoiceForm.taxpayer_number"}})],1):e._e(),1==e.invoiceForm.invoice_type?i("el-form-item",{attrs:{label:"请填写发票邮寄地址",prop:"invoice_full_address"}},[i("el-input",{model:{value:e.invoiceForm.invoice_full_address,callback:function(t){e.$set(e.invoiceForm,"invoice_full_address",t)},expression:"invoiceForm.invoice_full_address"}})],1):e._e(),2==e.invoiceForm.invoice_type?i("el-form-item",{attrs:{label:"请填写接收邮箱",prop:"invoice_email"}},[i("el-input",{model:{value:e.invoiceForm.invoice_email,callback:function(t){e.$set(e.invoiceForm,"invoice_email",t)},expression:"invoiceForm.invoice_email"}})],1):e._e(),e.invoiceForm.invoice_content_array.length>0?i("el-form-item",{attrs:{label:"发票内容",prop:"invoice_content"}},[i("el-radio-group",{model:{value:e.invoiceForm.invoice_content,callback:function(t){e.$set(e.invoiceForm,"invoice_content",t)},expression:"invoiceForm.invoice_content"}},e._l(e.invoiceForm.invoice_content_array,(function(t,s){return i("el-radio",{key:s,attrs:{label:t}},[e._v(e._s(t))])})),1)],1):e._e()],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.invoiceVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addmemberInvoice("invoiceForm")}}},[e._v("确 定")])],1)],1),e.orderPaymentData.member_account.balance_total>0?i("div",{staticClass:"item-block"},[i("div",{staticClass:"block-text"},[e._v("是否使用余额")]),i("div",{staticClass:"pay-type-list"},[i("div",{staticClass:"pay-type-item",class:e.orderCreateData.is_balance?"":"active",on:{click:function(t){return e.useBalance(0)}}},[e._v("不使用余额")]),i("div",{staticClass:"pay-type-item",class:e.orderCreateData.is_balance?"active":"",on:{click:function(t){return e.useBalance(1)}}},[e._v("使用余额")]),i("div",{staticClass:"clear"})])]):e._e(),e._m(1),e._l(e.orderPaymentData.shop_goods_list,(function(t,s){return i("div",{key:s},[i("div",{staticClass:"item-block"},[i("div",{staticClass:"goods-list"},[i("table",[i("tr",[i("td",{attrs:{colspan:"5"}},[i("i",{staticClass:"store-icon iconfont iconmendian"}),i("router-link",{attrs:{to:"/shop-"+t.site_id,target:"_blank"}},[e._v(e._s(t.site_name))])],1)])])])]),i("div",{staticClass:"item-block"},[i("div",{staticClass:"goods-list"},[i("table",e._l(t.goods_list,(function(s,o){return i("tr",{key:o},[i("td",{attrs:{width:"50%"}},[i("div",{staticClass:"goods-info"},[i("div",{staticClass:"goods-info-left"},[i("router-link",{attrs:{to:{path:"/sku-"+s.sku_id},target:"_blank"}},[i("img",{staticClass:"goods-img",attrs:{src:e.$img(s.sku_image,{size:"mid"})},on:{error:function(t){return e.imageError(o)}}})])],1),i("div",{staticClass:"goods-info-right"},[i("router-link",{attrs:{to:{path:"/sku-"+s.sku_id},target:"_blank"}},[i("div",{staticClass:"goods-name"},[e._v(e._s(s.sku_name))])])],1)])]),i("td",{staticClass:"goods-price",attrs:{width:"12.5%"}},[e._v("￥"+e._s(s.discount_price))]),i("td",{staticClass:"goods-num",attrs:{width:"12.5%"}},[e._v(e._s(s.num))]),0==o?i("td",{staticClass:"goods-money",attrs:{width:"12.5%",rowspan:t.goods_list.length}},[e._v("￥"+e._s(e._f("moneyFormat")(t.pay_money)))]):e._e()])})),0),i("div",{staticClass:"goods-footer"},[i("div",{staticClass:"goods-footer-left"},[0==e.orderPaymentData.is_virtual?i("div",[i("div",{staticClass:"order-cell",staticStyle:{display:"flex","justify-content":"start","align-items":"baseline"}},[i("div",{staticClass:"tit",staticStyle:{"margin-right":"10px"}},[e._v(" 配送方式： "),i("span",{staticClass:"ns-text-color"},["store"==e.orderPaymentData.delivery[t.site_id].delivery_type&&e.orderPaymentData.delivery[t.site_id].store_name?i("span",[e._v(" "+e._s(e.orderPaymentData.delivery[t.site_id].store_name)+" ")]):e._e()])]),t.express_type.length>0?i("div",e._l(t.express_type,(function(s,o){return"local"!=s.name?i("div",{key:o,staticClass:"express-item",class:e.orderPaymentData.delivery[t.site_id].delivery_type==s.name?"active":"",on:{click:function(i){return e.selectDeliveryType(s,t.site_id,t.express_type)}}},[e._v(" "+e._s(s.title)+" ")]):e._e()})),0):0==e.memberAddress.length?i("div",[i("div",{staticClass:"box ns-text-color"},[e._v("请先添加收货地址")])]):i("div",[i("div",{staticClass:"box ns-text-color"},[e._v("商家未配置配送方式")])])])]):e._e(),1==t.invoice_status?i("div",{staticClass:" order-cell",staticStyle:{display:"flex","justify-content":"start","align-items":"baseline"}},[i("div",{staticClass:"block-text",staticStyle:{"margin-right":"10px"}},[e._v("发票信息：")]),i("div",{staticClass:"pay-type-list"},[i("div",{staticClass:"express-item",class:1==t.is_invoice?"":"active",on:{click:function(i){return e.isInvoice(0,t.site_id)}}},[e._v(" 无需发票 ")]),i("div",{staticStyle:{display:"inline-block"},on:{click:function(i){return e.editInvoice(1,t.site_id)}}},[i("div",{staticClass:"express-item",class:1==t.is_invoice?"active":"",on:{click:function(i){return e.isInvoice(1,t.site_id)}}},[e._v(" 需要发票 ")])]),i("div",[1==t.invoice_type?i("div",{staticClass:"invoice-detail"},[e._v("纸质发票")]):e._e(),2==t.invoice_type?i("div",{staticClass:"invoice-detail"},[e._v("电子发票")]):e._e(),1==t.invoice_title_type?i("div",{staticClass:"invoice-detail"},[e._v("个人")]):e._e(),2==t.invoice_title_type?i("div",{staticClass:"invoice-detail"},[e._v("企业")]):e._e(),""!=t.invoice_content?i("div",{staticClass:"invoice-detail"},[e._v(e._s(t.invoice_content))]):e._e(),1==t.invoice_type||2==t.invoice_type?i("div",{staticClass:"invoice-detail",staticStyle:{color:"#FF4544"},on:{click:function(i){return e.editInvoice(1,t.site_id)}}},[e._v("修改")]):i("div",{staticClass:"invoice-detail",staticStyle:{color:"#FF4544"},on:{click:function(i){return e.editInvoice(1,t.site_id)}}},[i("div",{staticClass:"invoice-detail"},[e._v("请设置发票信息")]),i("span",{on:{click:function(i){return e.isInvoice(1,t.site_id)}}},[e._v("设置")])])]),i("div",{staticClass:"clear"})])]):e._e(),t.coupon_list.length>0?i("div",[i("div",{staticClass:"order-cell"},[i("div",{staticClass:"tit"},[e._v("优惠券")]),t.coupon_id?i("div",[i("span",{staticClass:"ns-text-color",on:{click:function(i){return e.openSiteCoupon(t.site_id,t.coupon_list)}}},[e._v("已选择优惠券，已优惠")]),i("span",{staticClass:"ns-text-color",on:{click:function(i){return e.openSiteCoupon(t.site_id,t.coupon_list)}}},[i("span",{staticClass:"inline"},[e._v("￥")]),e._v(" "+e._s(t.coupon_money)+" ")])]):i("div",[i("div",{staticClass:"box ns-text-color",on:{click:function(i){return e.openSiteCoupon(t.site_id,t.coupon_list)}}},[e._v("不使用优惠券")])])])]):e._e(),i("div",[t.promotion_money>0?i("div",{staticClass:"order-cell"},[i("span",{staticClass:"tit"},[e._v("店铺优惠")]),i("div",{staticClass:"box text-overflow"},e._l(t.promotion,(function(t,s){return i("div",{key:s,staticClass:"order-cell"},["manjian"==s?i("div",{staticClass:"box text-overflow"},[i("span",{staticClass:"ns-text-color"},[e._v("满减：")]),e._l(t,(function(t,s){return i("span",{key:s,staticClass:"ns-text-color"},[e._v(e._s(t.discount_array.desc))])}))],2):e._e(),"freeshipping"==s?i("div",{staticClass:"box text-overflow"},[i("span",{staticClass:"ns-text-color"},[e._v("满额包邮：")]),i("span",{staticClass:"ns-text-color"},[e._v(e._s(t.area_names)+" 满"+e._s(t.price)+"包邮")])]):e._e()])})),0)]):e._e()])]),i("div",{staticClass:"goods-footer-right"},[i("div",[i("div",{staticClass:"order-cell",staticStyle:{display:"flex","justify-content":"start"}},[i("div",{staticClass:"tit",staticStyle:{"margin-right":"10px"}},[e._v("买家留言：")]),i("div",{staticClass:"box"},[i("el-input",{staticClass:"buyer-message",attrs:{rows:"3",type:"textarea",placeholder:"留言前建议先与商家协调一致",maxlength:"140","show-word-limit":"",resize:"none"},on:{input:e.textarea},model:{value:e.orderCreateData.buyer_message[t.site_id],callback:function(i){e.$set(e.orderCreateData.buyer_message,t.site_id,i)},expression:"orderCreateData.buyer_message[siteItem.site_id]"}})],1)])])]),i("div",{staticClass:"clear"})])])])])})),e.orderPaymentData&&e.orderPaymentData.platform_coupon_list&&e.orderPaymentData.platform_coupon_list.length>0?i("div",{staticClass:"item-block"},[i("div",{staticClass:"block-text"},[e._v("平台优惠券")]),i("div",{staticClass:"order-cell platform-coupon"},[e.orderCreateData.platform_coupon_id?i("div",[i("span",{staticClass:"ns-text-color",on:{click:e.openPlatformCoupon}},[e._v("已选择优惠券，已优惠")]),i("span",{staticClass:"ns-text-color",on:{click:e.openPlatformCoupon}},[i("span",{staticClass:"inline"},[e._v("￥")]),e._v(" "+e._s(e.orderPaymentData.platform_coupon_money)+" ")])]):i("div",[i("div",{staticClass:"box ns-text-color",on:{click:e.openPlatformCoupon}},[e._v("不使用优惠券")])])])]):e._e(),i("div",{staticClass:"item-block"},[i("div",{staticClass:"order-statistics"},[i("table",[i("tr",[i("td",{attrs:{align:"right"}},[e._v("商品金额：")]),i("td",{attrs:{align:"left"}},[e._v("￥"+e._s(e._f("moneyFormat")(e.orderPaymentData.goods_money)))])]),0==e.orderPaymentData.is_virtual?i("tr",[i("td",{attrs:{align:"right"}},[e._v("运费：")]),i("td",{attrs:{align:"left"}},[e._v("￥"+e._s(e._f("moneyFormat")(e.orderPaymentData.delivery_money)))])]):e._e(),e.orderPaymentData.invoice_money>0?i("tr",[i("td",{attrs:{align:"right"}},[e._v("税费：")]),i("td",{attrs:{align:"left"}},[e._v("￥"+e._s(e._f("moneyFormat")(e.orderPaymentData.invoice_money)))])]):e._e(),e.orderPaymentData.promotion_money>0?i("tr",[i("td",{attrs:{align:"right"}},[e._v("优惠：")]),i("td",{attrs:{align:"left"}},[e._v("￥"+e._s(e._f("moneyFormat")(e.orderPaymentData.promotion_money)))])]):e._e(),e.orderPaymentData.coupon_money>0?i("tr",[i("td",{attrs:{align:"right"}},[e._v("店铺优惠券：")]),i("td",{attrs:{align:"left"}},[e._v("￥"+e._s(e._f("moneyFormat")(e.orderPaymentData.coupon_money)))])]):e._e(),e.orderPaymentData.platform_coupon_money>0?i("tr",[i("td",{attrs:{align:"right"}},[e._v("平台优惠券：")]),i("td",{attrs:{align:"left"}},[e._v("￥"+e._s(e._f("moneyFormat")(e.orderPaymentData.platform_coupon_money)))])]):e._e(),e.orderPaymentData.balance_money>0?i("tr",[i("td",{attrs:{align:"right"}},[e._v("使用余额：")]),i("td",{attrs:{align:"left"}},[e._v("￥"+e._s(e._f("moneyFormat")(e.orderPaymentData.balance_money)))])]):e._e()])]),i("div",{staticClass:"clear"})]),i("div",{staticClass:"item-block"},[i("div",{staticClass:"order-submit"},[i("div",{staticClass:"order-money"},[e._v(" 共"+e._s(e.orderPaymentData.goods_num)+"件，应付金额： "),i("div",{staticClass:"ns-text-color"},[e._v("￥"+e._s(e._f("moneyFormat")(e.orderPaymentData.pay_money)))])]),i("el-button",{staticClass:"el-button--primary",attrs:{type:"primary"},on:{click:e.orderCreate}},[e._v("订单结算")])],1),i("div",{staticClass:"clear"})]),i("el-dialog",{attrs:{title:"选择优惠券",visible:e.dialogCoupon,width:"50%"},on:{"update:visible":function(t){e.dialogCoupon=t}}},[i("el-table",{ref:"couponTable",staticClass:"cursor-pointer",attrs:{data:e.siteCoupon.data,"highlight-current-row":""},on:{"row-click":e.selectCoupon}},[i("el-table-column",{attrs:{label:"",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"disabled-selected-wrap"},[i("el-radio",{attrs:{label:t.row},model:{value:e.couponRadio,callback:function(t){e.couponRadio=t},expression:"couponRadio"}},[i("i")])],1)]}}])}),i("el-table-column",{attrs:{prop:"coupon_name",label:"名称",width:"200"}}),i("el-table-column",{attrs:{label:"优惠"},scopedSlots:e._u([{key:"default",fn:function(t){return["reward"==t.row.type?i("span",[e._v(e._s(t.row.money))]):e._e(),"discount"==t.row.type?i("span",[e._v(e._s(t.row.discount)+" 折")]):e._e()]}}])}),i("el-table-column",{attrs:{prop:"use",label:"使用"}}),i("el-table-column",{attrs:{prop:"time",label:"期限"}})],1),i("br"),i("div",{staticClass:"align-right"},[i("el-button",{on:{click:function(t){e.dialogCoupon=!1}}},[e._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveCoupon()}}},[e._v("确认选择")])],1)],1),i("el-dialog",{attrs:{title:"选择平台优惠券",visible:e.dialogPlatcoupon,width:"50%"},on:{"update:visible":function(t){e.dialogPlatcoupon=t},close:function(t){return e.savePlatformCoupon()}}},[i("el-table",{ref:"platformCouponTable",staticClass:"cursor-pointer",attrs:{data:e.orderPaymentData.platform_coupon_list,"highlight-current-row":""},on:{"row-click":e.selectPlatformCoupon}},[i("el-table-column",{attrs:{label:"",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"disabled-selected-wrap"},[i("el-radio",{attrs:{label:t.row},model:{value:e.platformCouponRadio,callback:function(t){e.platformCouponRadio=t},expression:"platformCouponRadio"}},[i("i")])],1)]}}])}),i("el-table-column",{attrs:{prop:"platformcoupon_name",label:"名称",width:"200"}}),i("el-table-column",{attrs:{prop:"money",label:"优惠"}}),i("el-table-column",{attrs:{label:"使用"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.at_least>0?i("span",{staticClass:"ns-text-color-gray ns-font-size-sm"},[e._v("满"+e._s(t.row.at_least)+"可用")]):i("span",{staticClass:"ns-text-color-gray ns-font-size-sm"},[e._v("任意金额可用")])]}}])}),i("el-table-column",{attrs:{label:"期限"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.$util.timeStampTurnTime(t.row.end_time)))])]}}])})],1),i("br"),i("div",{staticClass:"align-right"},[i("el-button",{on:{click:function(t){e.dialogPlatcoupon=!1}}},[e._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogPlatcoupon=!1}}},[e._v("确认选择")])],1)],1),i("el-dialog",{attrs:{title:"选择门店",visible:e.dialogStore,width:"50%"},on:{"update:visible":function(t){e.dialogStore=t}}},[i("el-table",{ref:"singleTable",staticClass:"cursor-pointer",attrs:{data:e.storeList,"highlight-current-row":""},on:{"row-click":e.selectStore}},[i("el-table-column",{attrs:{label:"",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-radio",{attrs:{label:t.row},model:{value:e.storeRadio,callback:function(t){e.storeRadio=t},expression:"storeRadio"}},[i("i")])]}}])}),i("el-table-column",{attrs:{prop:"store_name",label:"名称",width:"160"}}),i("el-table-column",{attrs:{prop:"store_address",label:"地址"}}),i("el-table-column",{attrs:{prop:"open_date",label:"营业时间"}})],1)],1),i("el-dialog",{attrs:{title:"送达时间",visible:e.deliveryTime,width:"400px"},on:{"update:visible":function(t){e.deliveryTime=t}}},[i("el-form",{ref:"ruleForm",attrs:{"status-icon":"","label-width":"100px"}},[i("el-form-item",{attrs:{label:"送达时间"}},[i("el-col",{attrs:{span:11}},[i("el-time-picker",{attrs:{format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间",value:e.time,start:"09:01",end:"21:01"},on:{change:e.bindTimeChange},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1)],1),i("el-form-item",{attrs:{label:""}},[i("el-col",{attrs:{span:20}},[i("div",{staticClass:"align-right"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.deliveryTime=!1}}},[e._v("关闭")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.setDeliveryTime(e.siteDelivery.site_id)}}},[e._v("确认选择")])],1)])],1)],1)],1),i("el-dialog",{attrs:{title:"使用余额",visible:e.dialogpay,width:"350px"},on:{"update:visible":function(t){e.dialogpay=t}}},[0==e.orderPaymentData.member_account.is_pay_password?[i("p",[e._v("为了您的账户安全,请您先设置的支付密码")]),i("p",[e._v('可到"会员中心","账号安全","支付密码"中设置')]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogpay=!1}}},[e._v("暂不设置")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.setPayPassword}},[e._v("立即设置")])],1)]:i("el-form",{ref:"ruleForm",attrs:{"status-icon":"","label-width":"100px"}},[i("el-form-item",{staticClass:"pay-password-item",attrs:{label:"支付密码"}},[i("el-input",{staticClass:"pay-password hide-password",attrs:{type:"password",maxlength:6}}),i("el-input",{staticClass:"pay-password",attrs:{type:"password",maxlength:6},on:{input:e.input},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),i("p",{staticClass:"ns-text-color forget-password",on:{click:e.setPayPassword}},[e._v("忘记密码")])],1)],2)],2)},o=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"add-address"},[i("i",{staticClass:"el-icon-circle-plus-outline"}),e._v(" 添加收货地址 ")])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"item-block"},[i("div",{staticClass:"goods-list"},[i("table",[i("tr",[i("td",{attrs:{width:"50%"}},[e._v("商品")]),i("td",{attrs:{width:"12.5%"}},[e._v("价格")]),i("td",{attrs:{width:"12.5%"}},[e._v("数量")]),i("td",{attrs:{width:"12.5%"}},[e._v("小计")])])])])])}],a=i("86bd"),r=i("5530"),n=(i("b680"),i("159b"),i("b64b"),i("b0c0"),i("07ac"),i("b090")),c=i("69f9"),l=i("2f94"),d=i("2f62"),m={name:"payment",components:{},data:function(){var e=function(e,t,i){""===t?i(new Error("请输入手机号")):/^1[3|4|5|6|7|8|9][0-9]{9}$/.test(t)?i():i(new Error("手机号格式错误"))};return{dialogVisible:!1,invoiceVisible:!1,memberAddress:[],invoiceList:[],siteId:"",addressId:0,addressForm:{id:0,name:"",mobile:"",telephone:"",province_id:"",city_id:"",district_id:"",community_id:"",address:"",full_address:"",is_default:"",longitude:"",latitude:""},invoiceForm:{invoice_type:1,invoice_title_type:1,invoice_content:"",invoice_title:"",taxpayer_number:"",invoice_full_address:"",invoice_email:"",invoice_content_array:[]},paperData:[{name:"纸质发票",value:1},{name:"电子发票",value:2}],enterpriseData:[{name:"个人",value:1},{name:"企业",value:2}],pickerValueArray:{},cityArr:{},districtArr:{},addressRules:{name:[{required:!0,message:"请输入收货人",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],mobile:[{required:!0,validator:e,trigger:"change"}],province:[{required:!0,message:"请选择省",trigger:"change"}],city:[{required:!0,message:"请选择市",trigger:"change"}],district:[{required:!0,message:"请选择区/县",trigger:"change"}],address:[{required:!0,message:"请输入详细地址",trigger:"change"}]},invoiceRules:{invoice_type:[{required:!0,message:"请选择发票类型",trigger:"change"}],invoice_title_type:[{required:!0,message:"请选择发票抬头类型",trigger:"change"}],invoice_content:[{required:!0,message:"请选择发票内容",trigger:"change"}],invoice_title:[{required:!0,message:"请填写抬头名称",trigger:"blur"}],taxpayer_number:[{required:!0,message:"请填写纳税人识别号",trigger:"blur"}],invoice_full_address:[{required:!0,message:"请填写发票邮寄地址",trigger:"blur"}],invoice_email:[{required:!0,message:"请填写发票接收邮箱",trigger:"blur"}]},isSend:!1,orderCreateData:{is_balance:0,pay_password:"",platform_coupon_id:0,buyer_message:{},invoice:{}},orderPaymentData:{goods_money:0,pay_money:0,is_invoice:0,member_account:{balance:0,is_pay_password:0},platform_coupon_list:[]},dialogCoupon:!1,siteCoupon:{site_id:0,data:[]},siteDelivery:{site_id:0,data:[]},dialogStore:!1,promotionInfo:!1,storeList:{},sitePromotion:[],isSub:!1,dialogpay:!1,password:"",fullscreenLoading:!0,deliveryTime:!1,timeTip:"选择配送时间",time:null,addressShow:!1,couponRadio:0,storeRadio:0,dialogPlatcoupon:!1,platformCouponRadio:0}},computed:Object(r["a"])({},Object(d["b"])(["orderCreateGoodsData","defaultGoodsImage","city"])),mounted:function(){},created:function(){this.getMemberAddress(),this.getOrderPaymentData()},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)},promotion:function(e){var t="";return e&&Object.keys(e).forEach((function(i){t+=e[i].content+"　"})),t}},methods:{getMemberAddress:function(){var e=this;Object(c["e"])({page_size:0}).then((function(t){t.code,t.message;var i=t.data;if(i&&i.list){var s=e;e.memberAddress=i.list,i.list.forEach((function(e){1==e.is_default&&(s.addressId=e.id)}))}})).catch((function(t){t.code;var i=t.message;t.data;e.$message.error(i)}))},setMemberAddress:function(e){var t=this;this.addressId=e,Object(c["n"])({id:e}).then((function(e){e.code,e.message,e.data;t.orderCalculate()})).catch((function(e){e.code;var i=e.message;e.data;t.$message.error(i)}))},deleteMemberAddress:function(e){var t=this;Object(c["i"])({id:e}).then((function(e){e.code;var i=e.message,s=e.data;s?(t.$message({message:i,type:"success"}),t.getMemberAddress()):t.$message({message:i,type:"warning"})})).catch((function(e){t.$message.error(e.message)}))},addAddressShow:function(){this.dialogVisible=!0,this.addressForm.id=0,this.addressForm.name="",this.addressForm.mobile="",this.addressForm.telephone="",this.addressForm.province_id="",this.addressForm.city_id="",this.addressForm.district_id="",this.addressForm.community_id="",this.addressForm.address="",this.addressForm.full_address="",this.addressForm.is_default="",this.addressForm.longitude="",this.addressForm.latitude="",this.cityArr={},this.districtArr={},this.getAddress(0)},getAddress:function(e){var t=this,i=0,s=this;switch(e){case 0:i=0;break;case 1:i=this.addressForm.province_id,s.cityArr={},s.districtArr={},this.addressForm.city_id="",this.addressForm.district_id="";break;case 2:i=this.addressForm.city_id,s.districtArr={},this.addressForm.district_id="";break}Object(l["a"])({pid:i}).then((function(t){t.code,t.message;var i=t.data;if(i)switch(e){case 0:s.pickerValueArray=i;break;case 1:s.cityArr=i;break;case 2:s.districtArr=i;break}})).catch((function(e){e.code;var i=e.message;e.data;t.$message.error(i)}))},initAddress:function(e){var t=this,i=0,s=this;switch(e){case 0:i=0;break;case 1:i=this.addressForm.province_id,s.cityArr={},s.districtArr={};break;case 2:i=this.addressForm.city_id,s.districtArr={};break}Object(l["a"])({pid:i}).then((function(t){t.code,t.message;var i=t.data;if(i)switch(e){case 0:s.pickerValueArray=i;break;case 1:s.cityArr=i;break;case 2:s.districtArr=i;break}})).catch((function(e){e.code;var i=e.message;e.data;t.$message.error(i)}))},addmemberAddress:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;if(t.isSend)return!1;if(t.addressForm.id){t.addressForm.full_address=t.$refs.province.selectedLabel+"-"+t.$refs.city.selectedLabel+"-"+t.$refs.district.selectedLabel;var i=t.addressForm;if(!i.province_id)return t.$message({message:"请选择省",type:"warning"}),!1;if(!i.city_id)return t.$message({message:"请选择市",type:"warning"}),!1;if(!i.district_id)return t.$message({message:"请选择区/县",type:"warning"}),!1;t.isSend=!0,t.setMemberAddress(i.id),i.url="edit",Object(c["m"])(i).then((function(e){e.code;var i=e.message,s=e.data;s?(t.$message({message:i,type:"success"}),t.dialogVisible=!1,t.getMemberAddress(),t.getOrderPaymentData()):t.$message({message:i,type:"warning"}),t.isSend=!1})).catch((function(e){e.code;var i=e.message;e.data;t.$message.error(i)}))}else{t.addressForm.full_address=t.$refs.province.selectedLabel+"-"+t.$refs.city.selectedLabel+"-"+t.$refs.district.selectedLabel;var s={name:t.addressForm.name,mobile:t.addressForm.mobile,telephone:t.addressForm.telephone,province_id:t.addressForm.province_id,city_id:t.addressForm.city_id,district_id:t.addressForm.district_id,community_id:"",address:t.addressForm.address,full_address:t.addressForm.full_address,longitude:t.addressForm.longitude,latitude:t.addressForm.latitude,is_default:t.addressForm.is_default,url:"add"};if(!s.province_id||s.province_id<=0)return t.$message({message:"请选择省",type:"warning"}),!1;if(!s.city_id||s.city_id<=0)return t.$message({message:"请选择市",type:"warning"}),!1;if(!s.district_id||s.district_id<=0)return t.$message({message:"请选择区/县",type:"warning"}),!1;t.isSend=!0,Object(c["m"])(s).then((function(e){e.code;var i=e.message,s=e.data;s?(t.setMemberAddress(s),t.$message({message:i,type:"success"}),t.dialogVisible=!1,t.getMemberAddress(),t.getOrderPaymentData()):t.$message({message:i,type:"warning"}),t.isSend=!1})).catch((function(e){e.code;var i=e.message;e.data;t.$message.error(i)}))}}))},addmemberInvoice:function(e){for(var t in this.invoiceList)if(this.siteId==t){if(t,this.invoiceList[t].is_invoice=1,this.invoiceList[t].invoice_type=this.invoiceForm.invoice_type,this.invoiceList[t].invoice_title_type=this.invoiceForm.invoice_title_type,this.invoiceList[t].invoice_content=this.invoiceForm.invoice_content,this.invoiceList[t].invoice_title=this.invoiceForm.invoice_title,this.invoiceList[t].taxpayer_number=this.invoiceForm.taxpayer_number,this.invoiceList[t].invoice_full_address=this.invoiceForm.invoice_full_address,this.invoiceList[t].invoice_email=this.invoiceForm.invoice_email,1==this.invoiceList[t].invoice_type&&1==this.invoiceList[t].invoice_title_type&&(!this.invoiceList[t].invoice_full_address||!this.invoiceList[t].invoice_title))return void this.$message.error({message:"请填写完信息",type:"warning"});if(1==this.invoiceList[t].invoice_type&&2==this.invoiceList[t].invoice_title_type&&(!this.invoiceList[t].invoice_full_address||!this.invoiceList[t].invoice_title||!this.invoiceList[t].taxpayer_number))return void this.$message.error({message:"请填写完信息",type:"warning"});if(2==this.invoiceList[t].invoice_type&&1==this.invoiceList[t].invoice_title_type&&(!this.invoiceList[t].invoice_email||!this.invoiceList[t].invoice_title))return void this.$message.error({message:"请填写完信息",type:"warning"});if(2==this.invoiceList[t].invoice_type&&2==this.invoiceList[t].invoice_title_type&&(!this.invoiceList[t].invoice_email||!this.invoiceList[t].invoice_title||!this.invoiceList[t].taxpayer_number))return void this.$message.error({message:"请填写完信息",type:"warning"});if(this.invoiceList[t].invoice_content_array.length>0&&!this.invoiceForm.invoice_content)return void this.$message.error({message:"请填写完信息",type:"warning"})}for(var i in this.orderPaymentData.shop_goods_list)this.siteId==i&&(i,this.orderPaymentData.shop_goods_list[i].invoice_type=this.invoiceForm.invoice_type,this.orderPaymentData.shop_goods_list[i].invoice_title_type=this.invoiceForm.invoice_title_type,this.orderPaymentData.shop_goods_list[i].invoice_content=this.invoiceForm.invoice_content);this.invoiceVisible=!1},editInvoice:function(e,t){this.invoiceVisible=!0;var i=this;for(var s in i.invoiceList)t==s&&(i.invoiceList[s].is_invoice=e,i.invoiceForm.invoice_content_array=i.invoiceList[s].invoice_content_array,i.invoiceForm.invoice_content=i.invoiceList[s].invoice_content,i.invoiceForm.invoice_email=i.invoiceList[s].invoice_email,i.invoiceForm.invoice_title=i.invoiceList[s].invoice_title,i.invoiceForm.taxpayer_number=i.invoiceList[s].taxpayer_number,i.invoiceForm.invoice_full_address=i.invoiceList[s].invoice_full_address,i.invoiceForm.invoice_title_type=i.invoiceList[s].invoice_title_type,i.invoiceForm.invoice_type=i.invoiceList[s].invoice_type);Object.values(i.orderPaymentData.shop_goods_list).forEach((function(i,s){t==i.site_id&&(i.is_invoice=e)})),i.siteId=t},editAddress:function(e){var t=this;Object(c["d"])({id:e}).then((function(e){e.code,e.message;var i=e.data;t.addressForm={id:i.id,name:i.name,mobile:i.mobile,telephone:i.telephone,province_id:i.province_id,city_id:"",district_id:"",community_id:"",address:i.address,full_address:i.full_address,is_default:i.is_default,longitude:i.longitude,latitude:i.latitude},t.initAddress(0),t.initAddress(1),t.addressForm.city_id=i.city_id,t.initAddress(2),t.addressForm.district_id=i.district_id,t.dialogVisible=!0})).catch((function(e){e.code;var i=e.message;e.data;t.$message.error(i)}))},getOrderPaymentData:function(){var e=this;this.orderCreateData=this.orderCreateGoodsData,this.orderCreateData?(this.orderCreateData.web_city=this.city?this.city.id:0,Object(n["d"])(this.orderCreateData).then((function(t){var i=t.code,s=(t.message,t.data);if(i>=0){e.orderPaymentData=s;var o=JSON.parse(JSON.stringify(s.shop_goods_list)),a={};for(var r in Object.values(o).forEach((function(t,i){a[t.site_id]={},e.invoiceList=a})),e.orderPaymentData.shop_goods_list)for(var n in e.invoiceList)n==r&&(e.invoiceList[n].is_invoice=e.orderPaymentData.is_invoice?1:0,e.orderPaymentData.shop_goods_list[r].invoice&&e.orderPaymentData.shop_goods_list[r].invoice.invoice_content_array?e.invoiceList[n].invoice_content_array=e.orderPaymentData.shop_goods_list[r].invoice.invoice_content_array:e.invoiceList[n].invoice_content_array=[]);Object.values(e.invoiceList).forEach((function(t,i){t.invoice_type=e.invoiceForm.invoice_type,t.invoice_title_type=e.invoiceForm.invoice_title_type,t.invoice_content=e.invoiceForm.invoice_content,t.invoice_title=e.invoiceForm.invoice_title,t.taxpayer_number=e.invoiceForm.taxpayer_number,t.invoice_full_address=e.invoiceForm.invoice_full_address,t.invoice_email=e.invoiceForm.invoice_email})),e.handlePaymentData()}else e.$message({message:"未获取到创建订单所需数据！",type:"warning",offset:225,duration:3e3,onClose:function(){return e.$router.go(-1),!1}})})).catch((function(t){t.code;var i=t.message;t.data;e.$message.error(i)}))):this.$message({message:"未获取到创建订单所需数据！",type:"warning",offset:225,duration:3e3,onClose:function(){return e.$router.go(-1),!1}})},handlePaymentData:function(){var e=this;this.orderCreateData.delivery={},this.orderCreateData.coupon={},this.orderCreateData.buyer_message={},this.orderCreateData.is_balance=0,this.orderCreateData.pay_password="";var t=this.orderPaymentData;Object.keys(t.shop_goods_list).forEach((function(i,s){var o=t.shop_goods_list[i];e.orderCreateData.delivery[i]={},void 0!=o.express_type[0]&&(e.orderCreateData.delivery[i].delivery_type=o.express_type[0].name,e.orderCreateData.delivery[i].delivery_type_name=o.express_type[0].title,e.orderCreateData.delivery[i].store_id=0,"store"==o.express_type[0].name&&void 0!=o.express_type[0].store_list[0]&&(e.orderCreateData.delivery[i].store_id=o.express_type[0].store_list[0].store_id)),e.orderCreateData.coupon[i]={},void 0!=o.coupon_list[0]&&(e.orderCreateData.coupon[i].coupon_id=o.coupon_list[0].coupon_id,e.orderCreateData.coupon[i].coupon_money=o.coupon_list[0].money),e.orderCreateData.buyer_message[i]=""})),this.orderPaymentData.is_virtual&&(this.orderCreateData.member_address={mobile:""}),this.orderPaymentData.platform_coupon_list.length>0&&(this.orderPaymentData.platform_coupon_id=this.orderPaymentData.platform_coupon_list[0].platformcoupon_id,this.orderCreateData.platform_coupon_id=this.orderPaymentData.platform_coupon_list[0].platformcoupon_id,this.orderPaymentData.platform_coupon_money=this.orderPaymentData.platform_coupon_list[0].money,this.orderCreateData.platform_coupon_money=this.orderPaymentData.platform_coupon_list[0].money),Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate()},orderCalculate:function(){var e=this;this.fullscreenLoading=!0;var t=this.$util.deepClone(this.orderCreateData);t.delivery=JSON.stringify(t.delivery),t.coupon=JSON.stringify(t.coupon),t.member_address=JSON.stringify(t.member_address),Object(n["a"])(t).then((function(t){var i=t.code,s=t.message;t.data;i>=0?(e.orderPaymentData.delivery_money=t.data.delivery_money,e.orderPaymentData.coupon_money=t.data.coupon_money,e.orderPaymentData.invoice_money=t.data.invoice_money,e.orderPaymentData.promotion_money=t.data.promotion_money,e.orderPaymentData.order_money=t.data.order_money,e.orderPaymentData.balance_money=t.data.balance_money,e.orderPaymentData.pay_money=t.data.pay_money,e.orderPaymentData.goods_money=t.data.goods_money,Object.keys(t.data.shop_goods_list).forEach((function(i,s){var o=t.data.shop_goods_list[i];e.orderPaymentData.shop_goods_list[i].pay_money=o.pay_money,e.orderPaymentData.shop_goods_list[i].coupon_money=o.coupon_money,e.orderPaymentData.shop_goods_list[i].coupon_id=o.coupon_id})),e.fullscreenLoading=!1):e.$message({message:s,type:"warning",offset:225,duration:3e3,onClose:function(){return e.$router.go(-1),!1}})})).catch((function(t){t.code;var i=t.message;t.data;e.$message.error(i),e.fullscreenLoading=!1}))},selectDeliveryType:function(e,t,i){if(this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},this.siteDelivery.site_id=t,this.siteDelivery.data=i,this.orderCreateData.delivery[t].delivery_type=e.name,this.orderCreateData.delivery[t].delivery_type_name=e.title,"store"==e.name){var s="",o=this;e.store_list.forEach((function(t,i){e.store_list[i]["store_address"]=t.full_address+t.address})),this.orderCreateData.delivery[t].store_id||void 0==e.store_list[0]||(this.orderCreateData.delivery[t].store_id=e.store_list[0].store_id,this.orderCreateData.delivery[t].store_name=e.store_list[0].store_name),e.store_list.forEach((function(e,i){o.orderCreateData.delivery[t].store_id==e.store_id&&(s=e)})),this.dialogStore=!0,this.storeList=e.store_list,setTimeout((function(){o.setStore(s),o.storeRadio=s}),50)}else"local"==e.name&&(this.deliveryTime=!0,this.time=this.orderCreateData.delivery[t].buyer_ask_delivery_time);Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate()},setStore:function(e){this.$refs.singleTable.setCurrentRow(e)},selectStore:function(e){if(e){var t=e.store_id;this.dialogStore=!1,this.orderCreateData.delivery[this.siteDelivery.site_id].store_id=t,this.orderCreateData.delivery[this.siteDelivery.site_id].store_name=e.store_name,Object.assign(this.orderPaymentData,this.orderCreateData),this.storeRadio=e,this.orderCalculate(),this.$forceUpdate()}},openPlatformCoupon:function(){var e=0,t=this;this.dialogPlatcoupon=!0,this.orderPaymentData.platform_coupon_list.forEach((function(i,s){i.platformcoupon_id==t.orderCreateData.platform_coupon_id&&(e=i)})),setTimeout((function(){t.setPlatformCurrent(e),t.platformCouponRadio=e}),50)},setPlatformCurrent:function(e){this.$refs.platformCouponTable.setCurrentRow(e),void 0==e&&this.orderCalculate()},savePlatformCoupon:function(){this.dialogPlatcoupon=!1,this.orderCalculate()},selectPlatformCoupon:function(e){e?this.orderCreateData.platform_coupon_id!=e.platformcoupon_id?(this.orderPaymentData.platform_coupon_id=e.platformcoupon_id,this.orderCreateData.platform_coupon_id=e.platformcoupon_id,this.orderPaymentData.platform_coupon_money=e.money,this.orderCreateData.platform_coupon_money=e.money,this.platformCouponRadio=e):(this.platformCouponRadio="",this.orderPaymentData.platform_coupon_id=0,this.orderCreateData.platform_coupon_id=0,this.orderPaymentData.platform_coupon_money="0.00",this.orderCreateData.platform_coupon_money="0.00"):(this.orderPaymentData.platform_coupon_id=0,this.orderCreateData.platform_coupon_id=0,this.orderPaymentData.platform_coupon_money="0.00",this.orderCreateData.platform_coupon_money="0.00",this.platformCouponRadio=""),Object.assign(this.orderPaymentData,this.orderCreateData),this.$forceUpdate()},openSiteCoupon:function(e,t){this.tempData={coupon:this.$util.deepClone(this.orderPaymentData.coupon)};var i=0,s=this;this.siteCoupon.site_id=e,t.forEach((function(e,o){e.at_least>0?t[o]["use"]="满"+e.at_least+"可用":t[o]["use"]="任意金额可用",t[o]["time"]=timeStampTurnTime(e.end_time),e.coupon_id==s.orderCreateData.coupon[s.siteCoupon.site_id].coupon_id&&(i=e)})),this.siteCoupon.data=t,this.dialogCoupon=!0,setTimeout((function(){s.setCurrent(i),s.couponRadio=i}),50)},selectCoupon:function(e){e?this.orderCreateData.coupon[this.siteCoupon.site_id].coupon_id!=e.coupon_id?(this.orderCreateData.coupon[this.siteCoupon.site_id].coupon_id=e.coupon_id,this.orderCreateData.coupon[this.siteCoupon.site_id].coupon_money=e.money,this.couponRadio=e):(this.couponRadio="",this.orderCreateData.coupon[this.siteCoupon.site_id].coupon_id=0,this.orderCreateData.coupon[this.siteCoupon.site_id].coupon_money="0.00"):(this.orderCreateData.coupon[this.siteCoupon.site_id].coupon_id=0,this.orderCreateData.coupon[this.siteCoupon.site_id].coupon_money="0.00",this.couponRadio=""),Object.assign(this.orderPaymentData,this.orderCreateData),this.$forceUpdate()},setCurrent:function(e){this.$refs.couponTable.setCurrentRow(e),void 0==e&&this.orderCalculate()},saveCoupon:function(){this.dialogCoupon=!1,this.orderCalculate()},openSitePromotion:function(e){this.sitePromotion=e,this.promotionInfo?this.promotionInfo=!1:this.promotionInfo=!0},useBalance:function(e){0==e?this.orderCreateData.is_balance=0:1==e&&(this.orderCreateData.is_balance=1),this.orderCalculate(),this.$forceUpdate()},isInvoice:function(e,t){var i=this;if(0==e)for(var s in i.orderPaymentData.shop_goods_list)t==s&&(i.orderPaymentData.shop_goods_list[s].is_invoice=0,i.orderPaymentData.shop_goods_list[s].invoice_type="",i.orderPaymentData.shop_goods_list[s].invoice_title_type="",i.orderPaymentData.shop_goods_list[s].invoice_content="",i.orderPaymentData.shop_goods_list[s].invoice_title="");else if(1==e)for(var o in i.invoiceList)t==o&&(i.invoiceForm.invoice_content_array=i.invoiceList[o].invoice_content_array,i.invoiceForm.invoice_content=i.invoiceList[o].invoice_content,i.invoiceForm.invoice_email=i.invoiceList[o].invoice_email,i.invoiceForm.invoice_title=i.invoiceList[o].invoice_title,i.invoiceForm.taxpayer_number=i.invoiceList[o].taxpayer_number,i.invoiceForm.invoice_full_address=i.invoiceList[o].invoice_full_address,i.invoiceForm.invoice_title_type=i.invoiceList[o].invoice_title_type,i.invoiceForm.invoice_type=i.invoiceList[o].invoice_type);i.siteId=t},orderCreate:function(){var e=this;if(this.verify()){if(this.isSub)return;this.isSub=!0;var t=this.$loading({lock:!0,text:"订单提交中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),i=this.$util.deepClone(this.orderCreateData);i.delivery=JSON.stringify(i.delivery),i.coupon=JSON.stringify(i.coupon),i.member_address=JSON.stringify(i.member_address),i.buyer_message=JSON.stringify(i.buyer_message),i.invoice=JSON.stringify(this.invoiceList),Object(n["c"])(i).then((function(i){var s=i.code,o=i.message,a=i.data;t.close(),s>=0?(e.$store.dispatch("order/removeOrderCreateData",""),0==e.orderPaymentData.pay_money?e.$router.push({path:"/result",query:{code:a}}):e.$router.push({path:"/pay",query:{code:a}})):e.$message({message:o,type:"warning"})})).catch((function(i){t.close(),e.isSub=!1;i.code;var s=i.message;i.data;e.$message.error(s)}))}},verify:function(){if(1==this.orderPaymentData.is_virtual){if(!this.orderCreateData.member_address.mobile.length)return this.$message({message:"请输入您的手机号码",type:"warning"}),!1;var e=/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/;if(!e.test(this.orderCreateData.member_address.mobile))return this.$message({message:"请输入正确的手机号码",type:"warning"}),!1}if(0==this.orderPaymentData.is_virtual){if(!this.orderPaymentData.member_address)return this.$message({message:"请先选择您的收货地址",type:"warning"}),!1;var t=!0;for(var i in this.orderCreateData.delivery){if("{}"==JSON.stringify(this.orderCreateData.delivery[i])){t=!1,this.$message({message:'店铺"'+this.orderPaymentData.shop_goods_list[i].site_name+'"未设置配送方式',type:"warning"});break}if("store"==this.orderCreateData.delivery[i].delivery_type&&0==this.orderCreateData.delivery[i].store_id){t=!1,this.$message({message:'店铺"'+this.orderPaymentData.shop_goods_list[i].site_name+'"没有可提货的门店,请选择其他配送方式',type:"warning"});break}}if(!t)return!1}return!0},input:function(){var e=this;if(6==this.password.length){var t=this.$loading({lock:!0,text:"支付中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(n["b"])({pay_password:this.password}).then((function(i){var s=i.code,o=i.message;i.data;t.close(),s>=0?(e.orderCreateData.pay_password=e.password,e.orderCreate(),e.dialogpay=!1):e.$message({message:o,type:"warning"})})).catch((function(i){t.close();i.code;var s=i.message;i.data;e.$message.error(s)}))}},textarea:function(){this.$forceUpdate()},bindTimeChange:function(e){this.time=e},setDeliveryTime:function(e){this.deliveryTime=!1,this.orderCreateData.delivery[e].buyer_ask_delivery_time=this.time},imageError:function(e){this.orderPaymentData.shop_goods_list.goods_list[e].sku_image=this.defaultGoodsImage},setPayPassword:function(){this.$router.pushToTab("/member/security")}}},u={name:"payment",components:{PicZoom:a["a"]},mixins:[m]},_=u,v=(i("30b4"),i("2877")),p=Object(v["a"])(_,s,o,!1,null,"a9f988dc",null);t["default"]=p.exports},a9e3:function(e,t,i){"use strict";var s=i("83ab"),o=i("da84"),a=i("94ca"),r=i("6eeb"),n=i("1a2d"),c=i("7156"),l=i("d9b5"),d=i("c04e"),m=i("d039"),u=i("241c").f,_=i("06cf").f,v=i("9bf2").f,p=i("408a"),h=i("58a8").trim,f="Number",g=o[f],y=g.prototype,b=function(e){var t=d(e,"number");return"bigint"===typeof t?t:C(t)},C=function(e){var t,i,s,o,a,r,n,c,m=d(e,"number");if(l(m))throw TypeError("Cannot convert a Symbol value to a number");if("string"==typeof m&&m.length>2)if(m=h(m),t=m.charCodeAt(0),43===t||45===t){if(i=m.charCodeAt(2),88===i||120===i)return NaN}else if(48===t){switch(m.charCodeAt(1)){case 66:case 98:s=2,o=49;break;case 79:case 111:s=8,o=55;break;default:return+m}for(a=m.slice(2),r=a.length,n=0;n<r;n++)if(c=a.charCodeAt(n),c<48||c>o)return NaN;return parseInt(a,s)}return+m};if(a(f,!g(" 0o1")||!g("0b1")||g("+0x1"))){for(var D,w=function(e){var t=arguments.length<1?0:g(b(e)),i=this;return i instanceof w&&m((function(){p(i)}))?c(Object(t),i,w):t},x=s?u(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),F=0;x.length>F;F++)n(g,D=x[F])&&!n(w,D)&&v(w,D,_(g,D));w.prototype=y,y.constructor=w,r(o,f,w)}},b090:function(e,t,i){"use strict";i.d(t,"d",(function(){return o})),i.d(t,"a",(function(){return a})),i.d(t,"c",(function(){return r})),i.d(t,"b",(function(){return n}));var s=i("751a");function o(e){return Object(s["a"])({url:"/api/ordercreate/payment",data:e,forceLogin:!0})}function a(e){return Object(s["a"])({url:"/api/ordercreate/calculate",data:e,forceLogin:!0})}function r(e){return Object(s["a"])({url:"/api/ordercreate/create",data:e,forceLogin:!0})}function n(e){return Object(s["a"])({url:"/api/member/checkpaypassword",data:e,forceLogin:!0})}},d80c:function(e,t,i){}}]);
//# sourceMappingURL=chunk-3aa44e94.57cd11bc.js.map