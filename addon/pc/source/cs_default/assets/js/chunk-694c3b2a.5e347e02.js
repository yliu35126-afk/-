(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-694c3b2a"],{"5cbc":function(t,s,e){},"8a08":function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cart"},[t.cartList.length||t.invalidGoods.length?[s("nav",[s("li",[s("el-checkbox",{on:{change:t.allElection},model:{value:t.checkAll,callback:function(s){t.checkAll=s},expression:"checkAll"}})],1),s("li",[t._v("商品信息")]),s("li",[t._v("价格")]),s("li",[t._v("数量")]),s("li",[t._v("小计")]),s("li",[t._v("操作")])]),t._l(t.cartList,(function(e,i){return s("div",{key:i,staticClass:"list"},[s("div",{staticClass:"item"},[s("div",{staticClass:"head"},[s("el-checkbox",{on:{change:function(s){return t.siteAllElection(i)}},model:{value:e.checked,callback:function(s){t.$set(e,"checked",s)},expression:"siteItem.checked"}}),s("router-link",{attrs:{to:"/shop",target:"_blank"}},[t._v(t._s(e.siteName))]),1==e.cartList[0].is_own?s("el-tag",{attrs:{size:"small"}},[t._v("自营")]):t._e()],1),t._l(e.cartList,(function(e,a){return s("ul",{key:a},[s("li",[s("el-checkbox",{on:{change:function(s){return t.singleElection(i,a)}},model:{value:e.checked,callback:function(s){t.$set(e,"checked",s)},expression:"item.checked"}})],1),s("li",{staticClass:"goods-info-wrap",on:{click:function(s){return t.$router.pushToTab({path:"/sku-"+e.sku_id})}}},[s("div",{staticClass:"img-wrap"},[s("img",{staticClass:"img-thumbnail",attrs:{src:t.$img(e.sku_image,{size:"mid"})},on:{error:function(s){return t.imageError(i,a)}}})]),s("div",{staticClass:"info-wrap"},[s("h5",[t._v(t._s(e.sku_name))]),e.sku_spec_format?t._l(e.sku_spec_format,(function(i,a){return s("span",{key:a},[t._v(" "+t._s(i.spec_name)+"："+t._s(i.spec_value_name)+" "+t._s(a<e.sku_spec_format.length-1?"；":"")+" ")])})):t._e()],2)]),s("li",[s("span",[t._v("￥"+t._s(e.discount_price))])]),s("li",[s("el-input-number",{attrs:{step:t.modifyNum,size:"mini",min:1,max:e.stock},on:{change:function(s){return t.cartNumChange(s,{siteIndex:i,cartIndex:a})}},model:{value:e.num,callback:function(s){t.$set(e,"num",s)},expression:"item.num"}})],1),s("li",[e.discount_price*e.num?s("strong",{staticClass:"subtotal ns-text-color"},[t._v("￥"+t._s((e.discount_price*e.num).toFixed(2)))]):s("strong",{staticClass:"subtotal ns-text-color"},[t._v("￥0")])]),s("li",[s("el-button",{attrs:{type:"text"},on:{click:function(s){return t.deleteCart(i,a)}}},[t._v("删除")])],1)])}))],2)])})),t.invalidGoods.length?s("div",{staticClass:"lose-list"},[s("div",{staticClass:"head"},[t._v(" 失效商品 "),s("span",{staticClass:"ns-text-color"},[t._v(t._s(t.invalidGoods.length))]),t._v(" 件 ")]),t._l(t.invalidGoods,(function(e,i){return s("ul",{key:i},[s("li",[s("el-tag",{attrs:{size:"small",type:"info"}},[t._v("失效")])],1),s("li",{staticClass:"goods-info-wrap"},[s("div",{staticClass:"img-wrap"},[s("img",{staticClass:"img-thumbnail",attrs:{src:t.$img(e.sku_image,{size:"mid"})},on:{error:function(s){return t.imageErrorInvalid(i)}}})]),s("div",{staticClass:"info-wrap"},[s("h5",[t._v(t._s(e.sku_name))]),e.sku_spec_format?t._l(e.sku_spec_format,(function(i,a){return s("span",{key:a},[t._v(" "+t._s(i.spec_name)+"："+t._s(i.spec_value_name)+" "+t._s(a<e.sku_spec_format.length-1?"；":"")+" ")])})):t._e()],2)]),s("li",[s("span",[t._v("￥"+t._s(e.discount_price))])]),s("li",[t._v(t._s(e.num))]),s("li",[s("strong",{staticClass:"subtotal"},[t._v("￥"+t._s(e.discount_price*e.num))])])])}))],2):t._e(),s("footer",[s("el-checkbox",{on:{change:t.allElection},model:{value:t.checkAll,callback:function(s){t.checkAll=s},expression:"checkAll"}},[t._v("全选")]),s("ul",{staticClass:"operation"},[s("li",[s("el-button",{attrs:{type:"text"},on:{click:t.deleteCartSelected}},[t._v("删除")])],1),s("li",[0!=t.invalidGoods.length?s("el-button",{attrs:{type:"text"},on:{click:t.clearInvalidGoods}},[t._v("清除失效宝贝")]):t._e()],1)]),s("div",{staticClass:"sum-wrap"},[s("div",{staticClass:"selected-sum"},[s("span",[t._v("已选商品")]),s("em",{staticClass:"total-count"},[t._v(t._s(t.totalCount))]),s("span",[t._v("件")])]),s("div",{staticClass:"price-wrap"},[s("span",[t._v("合计（不含运费）：")]),s("strong",{staticClass:"ns-text-color"},[t._v("￥"+t._s(t.totalPrice))])]),0!=t.totalCount?s("el-button",{attrs:{type:"primary"},on:{click:t.settlement}},[t._v("结算")]):s("el-button",{attrs:{type:"info",disabled:""},on:{click:t.settlement}},[t._v("结算")])],1)],1)]:t.loading||t.cartList.length&&t.invalidGoods.length?t._e():s("div",{staticClass:"empty-wrap"},[s("router-link",{attrs:{to:"/"}},[t._v("您的购物车是空的，赶快去逛逛，挑选商品吧！")])],1)],2)},a=[],c=(e("14d9"),e("2f62")),r=e("3177"),o={data:()=>({cartList:[],checkAll:!1,totalPrice:"0.00",totalCount:0,invalidGoods:[],loading:!0,modifyNum:1}),created(){this.getCartList()},computed:{...Object(c["b"])(["defaultGoodsImage"])},methods:{getCartList(){Object(r["b"])({}).then(t=>{t.code>=0&&t.data.length&&this.handleCartList(t.data),this.loading=!1}).catch(t=>{this.loading=!1})},handleCartList(t){this.invalidGoods=[],this.cartList=[];var s={};t.forEach((t,e)=>{1==t.goods_state&&1==t.verify_state?(t.checked=!0,void 0!=s["site_"+t.site_id]?s["site_"+t.site_id].cartList.push(t):s["site_"+t.site_id]={siteId:t.site_id,siteName:t.site_name,checked:!0,cartList:[t]}):this.invalidGoods.push(t)}),this.invalidGoods.forEach(t=>{t.sku_spec_format?(t.sku_spec_format=JSON.parse(t.sku_spec_format),console.log(t.sku_spec_format)):t.sku_spec_format=[]}),Object.keys(s).forEach(t=>{this.cartList.push(s[t])}),this.calculationTotalPrice(),this.cartList.forEach(t=>{t.cartList.forEach(t=>{t.sku_spec_format?t.sku_spec_format=JSON.parse(t.sku_spec_format):t.sku_spec_format=[]})})},singleElection(t,s){this.calculationTotalPrice()},siteAllElection(t){this.cartList[t].cartList.forEach(s=>{s.checked=this.cartList[t].checked}),this.calculationTotalPrice()},allElection(){this.cartList.length&&this.cartList.forEach(t=>{t.checked=this.checkAll,t.cartList.forEach(t=>{t.checked=this.checkAll})}),this.calculationTotalPrice()},calculationTotalPrice(){if(this.cartList.length){let t=0,s=0,e=0;this.cartList.forEach(i=>{let a=0;i.cartList.forEach(e=>{e.checked&&(a+=1,s+=1,t+=e.discount_price*e.num)}),i.cartList.length==a?(i.checked=!0,e+=1):i.checked=!1}),this.totalPrice=t.toFixed(2),this.totalCount=s,this.checkAll=this.cartList.length==e}else this.totalPrice="0.00",this.totalCount=0;this.modifyNum=1},deleteCart(t,s){this.$confirm("确定要删除该商品吗？","提示信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("cart/delete_cart",{cart_id:this.cartList[t].cartList[s].cart_id.toString()}).then(e=>{e.code>=0?(this.cartList[t].cartList.splice(s,1),0==this.cartList[t].cartList.length&&this.cartList.splice(t,1),this.calculationTotalPrice(),this.$message({type:"success",message:"删除成功"})):this.$message({message:e.message,type:"warning"})}).catch(t=>{this.$message.error(t.message)})})},deleteCartSelected(){var t=[],s=[];this.cartList.forEach((e,i)=>{e.cartList.forEach((a,c)=>{a.checked&&(t.push(a.cart_id),s.push({siteIndex:i,cartIndex:c,siteId:e.siteId,cartId:a.cart_id}))})}),0!=t.length?this.$confirm("确定要删除选择的商品吗？","提示信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("cart/delete_cart",{cart_id:t.toString()}).then(t=>{t.code>=0?(s.forEach(t=>{this.cartList.forEach((s,e)=>{s.cartList.forEach((i,a)=>{t.cartId==i.cart_id&&s.cartList.splice(a,1),0==s.cartList.length&&this.cartList.splice(e,1)})})}),this.calculationTotalPrice(),this.$message({type:"success",message:"删除成功"})):this.$message({message:t.message,type:"warning"})}).catch(t=>{this.$message.error(t.message)})}):this.$message({message:"请选择要删除的商品",type:"warning"})},clearInvalidGoods(){this.$confirm("确认要清空这些商品吗？","提示信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var t=[];this.invalidGoods.forEach(s=>{t.push(s.cart_id)}),t.length&&this.$store.dispatch("cart/delete_cart",{cart_id:t.toString()}).then(t=>{t.code>=0?(this.invalidGoods=[],this.$message({type:"success",message:"删除成功"})):this.$message({message:t.message,type:"warning"})}).catch(t=>{this.$message.error(t.message)})})},cartNumChange(t,s){console.log(t),console.log(s),(t<1||!t)&&(t=1),this.modifyNum=0,this.$store.dispatch("cart/edit_cart_num",{num:t,cart_id:this.cartList[s.siteIndex].cartList[s.cartIndex].cart_id}).then(e=>{e.code>=0?(this.cartList[s.siteIndex].cartList[s.cartIndex].num=t,this.calculationTotalPrice()):(this.$message({message:e.message,type:"warning"}),this.modifyNum=1)}).catch(t=>{this.$message.error(t.message),this.modifyNum=1})},settlement(){if(this.totalCount>0){let s=[];this.cartList.forEach(t=>{t.cartList.forEach(t=>{t.checked&&s.push(t.cart_id)})});var t={cart_ids:s.toString()};this.$store.dispatch("order/setOrderCreateData",t),this.$router.push({path:"/payment"})}},imageError(t,s){this.cartList[t].cartList[s].sku_image=this.defaultGoodsImage},imageErrorInvalid(t){this.invalidGoods[t].sku_image=this.defaultGoodsImage}}},n={name:"cart",mixins:[o]},l=n,h=(e("f66c"),e("2877")),d=Object(h["a"])(l,i,a,!1,null,"5505dd14",null);s["default"]=d.exports},f66c:function(t,s,e){"use strict";e("5cbc")}}]);
//# sourceMappingURL=chunk-694c3b2a.5e347e02.js.map