(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-765ca0d2"],{"22c8":function(s,e,t){},8024:function(s,e,t){},be26:function(s,e,t){"use strict";t("22c8")},c2d4:function(s,e,t){"use strict";t("8024")},f76d:function(s,e,t){"use strict";t.r(e);var i=function(){var s=this,e=s._self._c;return e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:s.loading,expression:"loading"}],staticClass:"ns-evalute"},[s._l(s.goodsList,(function(t,i){return e("div",{key:i,staticClass:"ns-eva-li"},[e("div",{staticClass:"ns-eva-good"},[e("el-image",{attrs:{fit:"scale-down",src:s.$img(t.sku_image,{size:"mid"})},on:{error:function(e){return s.imageError(i)},click:function(e){return s.toGoodsDetail(t.sku_id)}}}),e("p",{staticClass:"ns-eva-good-name",attrs:{title:t.sku_name},on:{click:function(e){return s.toGoodsDetail(t.sku_id)}}},[s._v(s._s(t.sku_name))]),e("p",[s._v("￥"+s._s(t.price))])],1),e("div",{staticClass:"ns-eva-form"},[s.isEvaluate?s._e():e("div",{staticClass:"block"},[e("span",{staticClass:"demonstration"},[s._v("描述相符：")]),e("el-rate",{on:{change:function(e){return s.setStar(i)}},model:{value:s.goodsEvalList[i].scores,callback:function(e){s.$set(s.goodsEvalList[i],"scores",e)},expression:"goodsEvalList[index].scores"}}),e("div",{staticClass:"level"},[e("i",{staticClass:"iconfont",class:"1"==s.goodsEvalList[i].explain_type?"iconhaoping1 ns-text-color":"2"==s.goodsEvalList[i].explain_type?"iconzhongchaping ns-text-color":"3"==s.goodsEvalList[i].explain_type?"iconzhongchaping":""}),e("span",[s._v(" "+s._s("1"==s.goodsEvalList[i].explain_type?"好评":"2"==s.goodsEvalList[i].explain_type?"中评":"3"==s.goodsEvalList[i].explain_type?"差评":"")+" ")])])],1),e("div",{staticClass:"ns-textarea"},[s.isEvaluate?e("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请在此处输入您的追评",maxlength:"200","show-word-limit":""},model:{value:s.goodsEvalList[i].again_content,callback:function(e){s.$set(s.goodsEvalList[i],"again_content",e)},expression:"goodsEvalList[index].again_content"}}):e("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请在此处输入您的评价",maxlength:"200","show-word-limit":""},model:{value:s.goodsEvalList[i].content,callback:function(e){s.$set(s.goodsEvalList[i],"content",e)},expression:"goodsEvalList[index].content"}})],1),e("el-upload",{ref:"upload",refInFor:!0,class:{ishide:s.hide[i]},attrs:{action:s.uploadActionUrl,"list-type":"picture-card","on-success":(e,t)=>s.handleSuccess(e,t,i),"on-preview":s.handlePictureCardPreview,"on-remove":(e,t)=>s.handleRemove(e,t,i),"on-exceed":s.handleExceed}},[e("i",{staticClass:"el-icon-plus"})]),e("el-dialog",{attrs:{visible:s.dialogVisible},on:{"update:visible":function(e){s.dialogVisible=e}}},[e("img",{attrs:{width:"100%",src:s.dialogImageUrl,alt:""}})]),e("span",[s._v("共6张，还能上传"+s._s(s.imgList[i].length?6-s.imgList[i].length:6)+"张")])],1)])})),s.isEvaluate?s._e():e("div",{staticClass:"ns-eva-public"},[e("div",{staticClass:"ns-eva-wrap"},[e("p",[s._v(s._s(s.siteName))]),e("div",{staticClass:"block"},[e("span",{staticClass:"demonstration"},[s._v("配送服务：")]),e("el-rate",{model:{value:s.shop_deliverycredit,callback:function(e){s.shop_deliverycredit=e},expression:"shop_deliverycredit"}})],1),e("div",{staticClass:"block"},[e("span",{staticClass:"demonstration"},[s._v("描述相符：")]),e("el-rate",{model:{value:s.shop_desccredit,callback:function(e){s.shop_desccredit=e},expression:"shop_desccredit"}})],1),e("div",{staticClass:"block"},[e("span",{staticClass:"demonstration"},[s._v("服务态度：")]),e("el-rate",{model:{value:s.shop_servicecredit,callback:function(e){s.shop_servicecredit=e},expression:"shop_servicecredit"}})],1),e("el-checkbox",{model:{value:s.isAnonymous,callback:function(e){s.isAnonymous=e},expression:"isAnonymous"}},[s._v("匿名")])],1)]),e("div",{staticClass:"save-btn-wrap"},[e("el-button",{attrs:{type:"primary"},on:{click:s.save}},[s._v("提交")])],1)],2)},a=[],o=(t("14d9"),t("2f62")),l=t("dea0"),d=t("01ea"),n={name:"evaluate",components:{},data:()=>({loading:!0,value1:5,memberName:"",memberNeadimg:"",orderId:null,orderNo:"",isAnonymous:0,goodsList:[],goodsEvalList:[],imgList:[],isEvaluate:0,flag:!1,siteName:"",shop_deliverycredit:5,shop_desccredit:5,shop_servicecredit:5,uploadActionUrl:d["a"].baseUrl+"/api/upload/evaluateimg",dialogImageUrl:"",dialogVisible:!1,hide:[]}),created(){this.orderId=this.$route.query.order_id,this.getUserInfo(),this.orderId&&this.getOrderInfo()},computed:{...Object(o["b"])(["defaultGoodsImage"])},methods:{handleSuccess(s,e,t){let i=this.imgList[t];i=i.concat(s.data.pic_path),this.imgList[t]=[],this.$set(this.imgList,t,i),this.isEvaluate?this.goodsEvalList[t].again_images=this.imgList[t].toString():this.goodsEvalList[t].images=this.imgList[t].toString(),this.imgList[t].length>=6&&(this.hide[t]=!0)},handleRemove(s,e,t){let i=util.inArray(s.response.data.pic_path,this.imgList[t]);this.imgList[t].splice(i,1),this.isEvaluate?this.goodsEvalList[t].again_images=this.imgList[t].toString():this.goodsEvalList[t].images=this.imgList[t].toString(),this.imgList[t].length<6&&(this.hide[t]=!1)},handleExceed(s,e){this.$message.warning("上传图片最大数量为6张")},handlePictureCardPreview(s){this.dialogImageUrl=s.url,this.dialogVisible=!0},getUserInfo(){this.$store.dispatch("member/member_detail",{refresh:1}).then(s=>{this.memberName=s.data.nickname,this.memberNeadimg=s.data.headimg}).catch(s=>{this.$message.error(s.message)})},getOrderInfo(){Object(l["h"])({order_id:this.orderId}).then(s=>{if(0==s.code)if(this.isEvaluate=s.data.evaluate_status,this.orderNo=s.data.list[0].order_no,this.goodsList=s.data.list,this.siteName=s.data.list[0].site_name,this.isEvaluate)for(let e=0;e<s.data.list.length;e++){let t=[];this.imgList.push(t),this.hide.push(!1),this.goodsEvalList.push({order_goods_id:s.data.list[e].order_goods_id,goods_id:s.data.list[e].goods_id,sku_id:s.data.list[e].sku_id,again_content:"",again_images:"",site_id:s.data.list[e].site_id})}else for(let e=0;e<s.data.list.length;e++){let t=[];this.imgList.push(t),this.goodsEvalList.push({content:"",images:"",scores:5,explain_type:1,order_goods_id:s.data.list[e].order_goods_id,goods_id:s.data.list[e].goods_id,sku_id:s.data.list[e].sku_id,sku_name:s.data.list[e].sku_name,sku_price:s.data.list[e].price,sku_image:s.data.list[e].sku_image,site_id:s.data.list[e].site_id})}this.loading=!1}).catch(s=>{this.$message.error(s.message),this.$router.push("/member/order_list"),this.loading=!1})},setStar(s){this.goodsEvalList[s].scores>=4?this.goodsEvalList[s].explain_type=1:1<this.goodsEvalList[s].scores&&this.goodsEvalList[s].scores<4?this.goodsEvalList[s].explain_type=2:this.goodsEvalList[s].explain_type=3},imageError(s){this.goodsList[s].sku_image=this.defaultGoodsImage},save(){for(let t=0;t<this.goodsEvalList.length;t++)if(this.isEvaluate){if(!this.goodsEvalList[t].again_content.trim().length)return void this.$message({message:"商品的评价不能为空哦",type:"warning"})}else if(!this.goodsEvalList[t].content.trim().length)return void this.$message({message:"商品的评价不能为空哦",type:"warning"});let s=JSON.stringify(this.goodsEvalList),e={order_id:this.orderId,goods_evaluate:s,isEvaluate:this.isEvaluate};this.isEvaluate||(e.order_no=this.orderNo,e.member_name=this.memberName,e.member_headimg=this.memberNeadimg,e.is_anonymous=this.isAnonymous,e.shop_deliverycredit=this.shop_deliverycredit,e.shop_desccredit=this.shop_desccredit,e.shop_servicecredit=this.shop_servicecredit),this.flag||(this.flag=!0,Object(l["i"])(e).then(s=>{0==s.code?this.$message({message:"评价成功",type:"success",duration:2e3,onClose:()=>{this.$router.push({path:"/member/order_list"})}}):(this.$message({message:s.message,type:"warning"}),this.flag=!1)}).catch(s=>{this.$message.error(s.message),this.flag=!1}))},toGoodsDetail(s){this.$router.pushToTab("sku-"+s)}}},r=n,c=(t("be26"),t("c2d4"),t("2877")),g=Object(c["a"])(r,i,a,!1,null,"5848e30d",null);e["default"]=g.exports}}]);
//# sourceMappingURL=chunk-765ca0d2.6260cf99.js.map