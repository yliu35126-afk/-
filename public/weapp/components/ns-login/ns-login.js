(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/ns-login/ns-login"],{"224e":function(e,t,a){},"26d9":function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return i}));var i={uniPopup:function(){return a.e("components/uni-popup/uni-popup").then(a.bind(null,"9ecd"))},registerReward:function(){return Promise.all([a.e("common/vendor"),a.e("components/register-reward/register-reward")]).then(a.bind(null,"3905"))}},o=function(){var e=this,t=e.$createElement,a=(e._self._c,e.avatarUrl?null:e.$util.getDefaultImage());e._isMounted||(e.e0=function(t){e.avatarUrl=e.$util.getDefaultImage().default_headimg}),e.$mp.data=Object.assign({},{$root:{g0:a}})},n=[]},3584:function(e,t,a){"use strict";a.r(t);var i=a("26d9"),o=a("a769");for(var n in o)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(n);a("8d18"),a("54b3");var s=a("f0c5"),r=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"518bdd36",null,!1,i["a"],void 0);t["default"]=r.exports},"42e9":function(e,t,a){},"54b3":function(e,t,a){"use strict";var i=a("224e"),o=a.n(i);o.a},"8d18":function(e,t,a){"use strict";var i=a("42e9"),o=a.n(i);o.a},a769:function(e,t,a){"use strict";a.r(t);var i=a("e7a5"),o=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(n);t["default"]=o.a},e7a5:function(e,t,a){"use strict";(function(e){var i=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;i(a("5bb4"));var o=i(a("3304")),n=i(a("1ad3")),s={mixins:[o.default],name:"ns-login",components:{uniPopup:function(){a.e("components/uni-popup/uni-popup").then(function(){return resolve(a("9ecd"))}.bind(null,a)).catch(a.oe)},registerReward:function(){Promise.all([a.e("common/vendor"),a.e("components/register-reward/register-reward")]).then(function(){return resolve(a("3905"))}.bind(null,a)).catch(a.oe)}},data:function(){return{url:"",registerConfig:{},avatarUrl:"",headImg:"",nickName:"",isSub:!1,captchaConfig:0,captcha:{id:"",img:""},formData:{key:"",mobile:"",vercode:"",dynacode:""},dynacodeData:{seconds:120,timer:null,codeText:"获取动态码",isSend:!1},authMobileData:{iv:"",encryptedData:""}}},options:{styleIsolation:"shared"},created:function(){this.getRegisterConfig()},mounted:function(){},watch:{"dynacodeData.seconds":{handler:function(e,t){0==e&&this.refreshDynacodeData()},immediate:!0,deep:!0}},computed:{isDisabled:function(){return 0==this.nickName.length||!(!this.forceBindingMobileControl||0!=this.formData.mobile.length)},forceBindingMobileControl:function(){return!(!this.registerConfig||1!=this.registerConfig.third_party||1!=this.registerConfig.bind_mobile)}},methods:{getRegisterConfig:function(){var e=this;this.$api.sendRequest({url:"/api/register/config",success:function(t){t.code>=0&&(e.registerConfig=t.data.value)}})},open:function(e){var t=this;e&&(this.url=e),this.getCode((function(e){t.authLogin(e,"authOnlyLogin")}))},toLogin:function(){this.url?this.$util.redirectTo("/pages/login/login/login",{back:encodeURIComponent(this.url)}):this.$util.redirectTo("/pages/login/login/login")},cancelCompleteInfo:function(){this.$refs.completeInfoPopup&&this.$refs.completeInfoPopup.close(),this.$store.commit("setBottomNavHidden",!1)},blurNickName:function(e){e.detail.value&&(this.nickName=e.detail.value)},onChooseAvatar:function(t){var a=this;this.avatarUrl=t.detail.avatarUrl,e.getFileSystemManager().readFile({filePath:this.avatarUrl,encoding:"base64",success:function(e){var t="data:image/jpeg;base64,"+e.data;a.myUpload(t)}})},myUpload:function(t){var a=this;e.request({url:this.$config.baseUrl+"/api/upload/headimgBase64",method:"POST",data:{app_type:"weapp",app_type_name:"weapp",images:t},header:{"content-type":"application/x-www-form-urlencoded;application/json"},dataType:"json",responseType:"text",success:function(e){0==e.data.code?a.headImg=e.data.data.pic_path:a.$util.showToast({title:e.message})},fail:function(){a.$util.showToast({title:"上传失败"})}})},openCompleteInfoPop:function(){var e=this;this.$refs.completeInfoPopup.open((function(){e.$store.commit("setBottomNavHidden",!1)})),this.$store.commit("setBottomNavHidden",!0)},getCaptchaConfig:function(){var e=this;this.$api.sendRequest({url:"/api/config/getCaptchaConfig",success:function(t){t.code>=0&&(e.captchaConfig=t.data.data.value.shop_reception_login,e.captchaConfig&&e.getCaptcha())}})},getCaptcha:function(){var e=this;this.$api.sendRequest({url:"/api/captcha/captcha",data:{captcha_id:this.captcha.id},success:function(t){t.code>=0&&(e.captcha=t.data,e.captcha.img=e.captcha.img.replace(/\r\n/g,""))}})},sendMobileCode:function(){var e=this;if(120==this.dynacodeData.seconds&&!this.dynacodeData.isSend){var t={mobile:this.formData.mobile,captcha_id:this.captcha.id,captcha_code:this.formData.vercode},a=[{name:"mobile",checkType:"required",errorMsg:"请输入手机号"},{name:"mobile",checkType:"phoneno",errorMsg:"请输入正确的手机号"}];1==this.captchaConfig&&a.push({name:"captcha_code",checkType:"required",errorMsg:"请输入验证码"});var i=n.default.check(t,a);i?(this.dynacodeData.isSend=!0,120==this.dynacodeData.seconds&&(this.dynacodeData.timer=setInterval((function(){e.dynacodeData.seconds--,e.dynacodeData.codeText=e.dynacodeData.seconds+"s后可重新获取"}),1e3)),this.$api.sendRequest({url:"/api/tripartite/mobileCode",data:t,success:function(t){t.code>=0?e.formData.key=t.data.key:(e.$util.showToast({title:t.message}),e.refreshDynacodeData())},fail:function(){e.$util.showToast({title:"request:fail"}),e.refreshDynacodeData()}})):this.$util.showToast({title:n.default.error})}},refreshDynacodeData:function(){this.getCaptcha(),clearInterval(this.dynacodeData.timer),this.dynacodeData={seconds:120,timer:null,codeText:"获取动态码",isSend:!1}},verify:function(e){var t=[{name:"mobile",checkType:"required",errorMsg:"请输入手机号"},{name:"mobile",checkType:"phoneno",errorMsg:"请输入正确的手机号"}];1==this.captchaConfig&&""!=this.captcha.id&&t.push({name:"captcha_code",checkType:"required",errorMsg:"请输入验证码"}),t.push({name:"code",checkType:"required",errorMsg:"请输入动态码"});var a=n.default.check(e,t);return!!a||(this.$util.showToast({title:n.default.error}),!1)},forceBindMobile:function(){var t=this,a=e.getStorageSync("authInfo"),i={mobile:this.formData.mobile,key:this.formData.key,code:this.formData.dynacode};""!=this.captcha.id&&(i.captcha_id=this.captcha.id,i.captcha_code=this.formData.vercode),a&&Object.assign(i,a),a.avatarUrl&&(i.headimg=a.avatarUrl),a.nickName&&(i.nickname=a.nickName),e.getStorageSync("source_member")&&(i.source_member=e.getStorageSync("source_member")),this.isSub||(this.isSub=!0,this.$api.sendRequest({url:"/api/tripartite/mobile",data:i,success:function(a){a.code>=0?(e.setStorage({key:"token",data:a.data.token,success:function(){t.$store.commit("setToken",a.data.token),t.$store.dispatch("getCartNumber")}}),t.$refs.completeInfoPopup.close(),t.$store.commit("setBottomNavHidden",!1),a.data.is_register&&t.$refs.registerReward.open()):(t.isSub=!1,t.getCaptcha(),t.$util.showToast({title:a.message}))},fail:function(e){t.isSub=!1,t.getCaptcha()}}))},getPhoneNumber:function(t){var a=this;if("getPhoneNumber:ok"==t.detail.errMsg){this.authMobileData={iv:t.detail.iv,encryptedData:t.detail.encryptedData};var i=e.getStorageSync("authInfo");i&&Object.assign(this.authMobileData,i),e.getStorageSync("source_member")&&(this.authMobileData.source_member=e.getStorageSync("source_member")),this.$api.sendRequest({url:"/api/tripartite/getPhoneNumber",data:this.authMobileData,success:function(e){e.code>=0?a.formData.mobile=e.data.mobile:(a.formData.mobile="",a.$util.showToast({title:e.message}))}})}},bindMobile:function(){var t=this,a=this.authMobileData,i=e.getStorageSync("authInfo");i&&Object.assign(a,i),i.avatarUrl&&(a.headimg=i.avatarUrl),i.nickName&&(a.nickname=i.nickName),this.$api.sendRequest({url:"/api/tripartite/mobileauth",data:a,success:function(a){a.code>=0?(e.setStorage({key:"token",data:a.data.token,success:function(){t.$store.dispatch("getCartNumber"),t.$store.commit("setToken",a.data.token),t.cancelCompleteInfo()}}),a.data.is_register&&t.$refs.registerReward.open()):t.$util.showToast({title:a.message})},fail:function(e){t.$util.showToast({title:"request:fail"})}})},authLogin:function(t){var a=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"authLogin";e.showLoading({title:"登录中"}),e.setStorage({key:"authInfo",data:t}),e.getStorageSync("source_member")&&(t.source_member=e.getStorageSync("source_member")),this.$api.sendRequest({url:"authLogin"==i?"/api/login/auth":"/api/login/authonlylogin",data:t,success:function(t){if(t.code>=0)e.setStorage({key:"token",data:t.data.token,success:function(){a.$store.dispatch("getCartNumber"),a.$store.commit("setToken",t.data.token),t.data.is_register&&a.$refs.registerReward.open(),a.cancelCompleteInfo()}}),setTimeout((function(){e.hideLoading()}),1e3);else if(-10016==t.code){t.message;a.$api.sendRequest({url:"/api/register/config",success:function(t){t.code>=0&&(a.registerConfig=t.data.value,1==a.registerConfig.third_party&&1==a.registerConfig.bind_mobile?(e.hideLoading(),a.openCompleteInfoPop()):0==a.registerConfig.third_party?(e.hideLoading(),a.toLogin()):(e.hideLoading(),a.openCompleteInfoPop()))}})}else e.hideLoading(),a.$util.showToast({title:t.message})},fail:function(){e.hideLoading(),a.$util.showToast({title:"登录失败"})}})},saveH5:function(){if(this.$util.isWeiXin()&&this.forceBindingMobileControl){var e={mobile:this.formData.mobile,key:this.formData.key,code:this.formData.dynacode};if(""!=this.captcha.id&&(e.captcha_id=this.captcha.id,e.captcha_code=this.formData.vercode),!this.verify(e))return}this.forceBindMobile()},saveMp:function(){if(0!=this.nickName.length){var t=e.getStorageSync("authInfo");t&&Object.assign(t,{nickName:this.nickName,avatarUrl:this.headImg}),e.setStorageSync("authInfo",t),this.forceBindingMobileControl?this.bindMobile():this.authLogin(t)}else this.$util.showToast({title:"请输入昵称"})}}};t.default=s}).call(this,a("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/ns-login/ns-login-create-component',
    {
        'components/ns-login/ns-login-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("3584"))
        })
    },
    [['components/ns-login/ns-login-create-component']]
]);
