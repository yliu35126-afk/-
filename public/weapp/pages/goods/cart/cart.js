(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/cart/cart"],{"06c8":function(t,a,e){},"28a5":function(t,a,e){"use strict";e.r(a);var i=e("a38f"),n=e.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){e.d(a,t,(function(){return i[t]}))}(o);a["default"]=n.a},"2f5f":function(t,a,e){"use strict";(function(t,a){var i=e("4ea4");e("3a80");i(e("66fd"));var n=i(e("4f58"));t.__webpack_require_UNI_MP_PLUGIN__=e,a(n.default)}).call(this,e("bc2e")["default"],e("543d")["createPage"])},"4f58":function(t,a,e){"use strict";e.r(a);var i=e("c1d9"),n=e("28a5");for(var o in n)["default"].indexOf(o)<0&&function(t){e.d(a,t,(function(){return n[t]}))}(o);e("b352"),e("cc1f");var c=e("f0c5"),r=Object(c["a"])(n["default"],i["b"],i["c"],!1,null,"1f2f0719",null,!1,i["a"],void 0);a["default"]=r.exports},a09d:function(t,a,e){},a38f:function(t,a,e){"use strict";(function(t){var i=e("4ea4");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=i(e("8f49")),o=i(e("0f13")),c={components:{nsGoodsRecommend:function(){e.e("components/ns-goods-recommend/ns-goods-recommend").then(function(){return resolve(e("63b7"))}.bind(null,e)).catch(e.oe)},uniNumberBox:function(){e.e("components/uni-number-box/uni-number-box").then(function(){return resolve(e("ce42"))}.bind(null,e)).catch(e.oe)},diyBottomNav:function(){e.e("components/diy-bottom-nav/diy-bottom-nav").then(function(){return resolve(e("8627"))}.bind(null,e)).catch(e.oe)},toTop:function(){e.e("components/toTop/toTop").then(function(){return resolve(e("be3c"))}.bind(null,e)).catch(e.oe)}},mixins:[n.default,o.default],data:function(){return{token:"",cartData:[],checkAll:!0,totalPrice:"0.00",totalCount:0,modifyFlag:!1,isSub:!1,invalidGoods:[],isIphoneX:!1,cartBottom:"56px",isAction:!1,startX:"",endX:""}},onLoad:function(){t.hideTabBar()},onShow:function(){this.$langConfig.refresh(),t.getStorageSync("token")?this.getCartData():(this.token="",this.cartData=[],this.calculationTotalPrice()),this.isIphoneX=this.$util.uniappIsIPhoneX(),this.$util.uniappIsIPhone11()&&(this.cartBottom="90px")},onReady:function(){t.getStorageSync("token")||this.$refs.loadingCover&&this.$refs.loadingCover.hide()},computed:{hasData:function(){return this.cartData.length>0||this.invalidGoods.length>0},storeToken:function(){return this.$store.state.token}},watch:{storeToken:function(t,a){this.getCartData()}},methods:{initNum:function(t){var a=t.max_buy>0&&t.max_buy<t.stock?t.max_buy:t.stock;return a=0==a?1:a,t.num>a?a:t.num},getCartData:function(){var a=this;this.$api.sendRequest({url:"/api/cart/goodslists",success:function(e){e.code>=0?(a.token=t.getStorageSync("token"),e.data.length?a.handleCartData(e.data):a.cartData=[]):a.token="",a.$refs.loadingCover&&a.$refs.loadingCover.hide()},fail:function(t){a.$refs.loadingCover&&a.$refs.loadingCover.hide()}})},handleCartData:function(t){var a=this;this.invalidGoods=[],this.cartData=[];var e={};t.forEach((function(t,i){1==t.goods_state&&1==t.verify_state&&0!=t.shop_status?t.min_buy>0&&t.min_buy>t.stock?a.invalidGoods.push(t):(t.checked=!0,t.edit=!1,void 0!=e["site_"+t.site_id]?e["site_"+t.site_id].cartList.push(t):e["site_"+t.site_id]={siteId:t.site_id,siteName:t.site_name,edit:!1,checked:!0,cartList:[t]}):a.invalidGoods.push(t)})),this.cartData=[],Object.keys(e).forEach((function(t){a.cartData.push(e[t])})),this.calculationTotalPrice(),this.cartData.length&&this.cartData.forEach((function(t){t.cartList.forEach((function(t){t.sku_spec_format?t.sku_spec_format=JSON.parse(t.sku_spec_format):t.sku_spec_format=[]}))})),this.invalidGoods.length&&this.invalidGoods.forEach((function(t){t.sku_spec_format?t.sku_spec_format=JSON.parse(t.sku_spec_format):t.sku_spec_format=[]}))},singleElection:function(t,a){this.cartData[t].cartList[a].checked=!this.cartData[t].cartList[a].checked,this.calculationTotalPrice()},siteAllElection:function(t,a){this.cartData[a].checked=t,this.cartData[a].cartList.forEach((function(a){a.checked=t})),this.calculationTotalPrice()},allElection:function(t){var a=this;this.checkAll="boolean"==typeof t?t:!this.checkAll,this.cartData.length&&this.cartData.forEach((function(t){t.checked=a.checkAll,t.cartList.forEach((function(t){t.checked=a.checkAll}))})),this.calculationTotalPrice()},calculationTotalPrice:function(){if(this.cartData.length){var t=0,a=0,e=0;this.cartData.forEach((function(i){var n=0;i.cartList.forEach((function(e){e.checked&&(n+=1,a+=parseInt(e.num),Number(e.member_price)>0&&Number(e.member_price)<Number(e.discount_price)?t+=e.member_price*e.num:t+=e.discount_price*e.num)})),i.cartList.length==n?(i.checked=!0,e+=1):i.checked=!1})),this.totalPrice=t.toFixed(2),this.totalCount=a,this.checkAll=this.cartData.length==e}else this.totalPrice="0.00",this.totalCount=0;this.modifyFlag=!1},deleteCart:function(a,e,i){var n=this,o=[];if("all"==a)for(var c=0;c<this.cartData.length;c++)for(var r=0;r<this.cartData[c].cartList.length;r++)this.cartData[c].cartList[r].checked&&o.push(this.cartData[c].cartList[r].cart_id);else o.push(this.cartData[e].cartList[i].cart_id);0!=o.length?t.showModal({title:"提示",content:"确定要删除这些商品吗？",success:function(t){t.confirm&&(o=o.toString(),n.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:o},success:function(t){if(t.code>=0){if("all"==a)for(var o=0;o<n.cartData.length;o++){for(var c=0;c<n.cartData[o].cartList.length;c++){var r=n.cartData[o].cartList[c];r.checked&&(n.cartData[o].cartList.splice(c,1),c=-1)}0==n.cartData[o].cartList.length&&(n.cartData.splice(o,1),o=-1)}else n.cartData[e].cartList.splice(i,1),0==n.cartData[e].cartList.length&&n.cartData.splice(e,1);n.calculationTotalPrice(),n.getCartNumber()}else n.$util.showToast({title:t.message})}}))}}):this.$util.showToast({title:"请选择要删除的商品"})},cartNumChange:function(t,a){var e=this;if(!isNaN(t)){var i=this.cartData[a.siteIndex].cartList[a.cartIndex],n=i.max_buy>0&&i.max_buy<i.stock?i.max_buy:i.stock,o=i.min_buy>0?i.min_buy:1;t>n&&(t=n),t<o&&(t=o),this.modifyFlag=!0,this.$api.sendRequest({url:"/api/cart/edit",data:{num:t,cart_id:this.cartData[a.siteIndex].cartList[a.cartIndex].cart_id},success:function(i){i.code>=0?(e.cartData[a.siteIndex].cartList[a.cartIndex].num=t,e.calculationTotalPrice(),e.getCartNumber()):e.$util.showToast({title:i.message})}})}},settlement:function(){var a=this;if(this.totalCount>0){var e=[];if(this.cartData.forEach((function(t){t.cartList.forEach((function(t){t.checked&&e.push(t.cart_id)}))})),this.isSub)return;this.isSub=!0,t.setStorage({key:"orderCreateData",data:{cart_ids:e.toString()},success:function(){a.$util.redirectTo("/pages/order/payment/payment"),a.isSub=!1}})}},clearInvalidGoods:function(){var a=this;t.showModal({title:"提示",content:"确定要清空这些商品吗？",success:function(t){if(t.confirm){var e=[];a.invalidGoods.forEach((function(t){e.push(t.cart_id)})),e.length&&a.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:e.toString()},success:function(t){t.code>=0?(a.invalidGoods=[],a.getCartNumber()):a.$util.showToast({title:t.message})}})}}})},imgError:function(t,a){this.cartData[t].cartList[a].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},toGoodsDetail:function(t){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.sku_id})},getCartNumber:function(){t.getStorageSync("token")&&(this.$store.dispatch("getCartNumber"),this.resetEditStatus())},goodsLimit:function(t,a,e){var i=this.cartData[a].cartList[e];"plus"==t.type?i.max_buy>0&&i.max_buy<i.stock?this.$util.showToast({title:"该商品每人限购"+i.max_buy+"件"}):this.$util.showToast({title:"库存不足"}):this.$util.showToast({title:"最少购买"+t.value+"件"})},toLogin:function(){this.$refs.login.open()},touchS:function(t){this.startX=t.touches[0].clientX},touchE:function(t,a){this.endX=t.changedTouches[0].clientX;var e=this.startX-this.endX;e>50?a.edit=!0:e<0&&(a.edit=!1),this.$forceUpdate()},resetEditStatus:function(){for(var t=0;t<this.cartData.length;t++)for(var a=0;a<this.cartData[t].cartList.length;a++)this.cartData[t].cartList[a].edit=!1;this.$forceUpdate()},changeAction:function(){this.isAction=!this.isAction,this.resetEditStatus()},showPrice:function(t){var a=t.discount_price;return t.member_price&&parseFloat(t.member_price)<parseFloat(a)&&(a=t.member_price),a}}};a.default=c}).call(this,e("543d")["default"])},b352:function(t,a,e){"use strict";var i=e("a09d"),n=e.n(i);n.a},c1d9:function(t,a,e){"use strict";e.d(a,"b",(function(){return n})),e.d(a,"c",(function(){return o})),e.d(a,"a",(function(){return i}));var i={uniNumberBox:function(){return e.e("components/uni-number-box/uni-number-box").then(e.bind(null,"ce42"))},loadingCover:function(){return e.e("components/loading-cover/loading-cover").then(e.bind(null,"5203"))},diyBottomNav:function(){return e.e("components/diy-bottom-nav/diy-bottom-nav").then(e.bind(null,"8627"))},nsLogin:function(){return Promise.all([e.e("common/vendor"),e.e("components/ns-login/ns-login")]).then(e.bind(null,"3584"))}},n=function(){var t=this,a=t.$createElement,e=(t._self._c,t.hasData?t.__map(t.cartData,(function(a,e){var i=t.__get_orig(a),n=a.cartList.length,o=t.isAction?t.$lang("complete"):null,c=t.isAction?null:t.$lang("edit"),r=t.$lang("del"),s=t.__map(a.cartList,(function(a,e){var i=t.__get_orig(a),n=t.$util.img(a.sku_image,{size:"mid"}),o=a.sku_spec_format?t.__map(a.sku_spec_format,(function(e,i){var n=t.__get_orig(e),o=a.sku_spec_format.length;return{$orig:n,g2:o}})):null,c=1==a.promotion_type?t.$lang("common.currencySymbol"):null,r=1==a.promotion_type?t.showPrice(a):null,s=1==a.promotion_type?Number(a.member_price)>0&&Number(a.member_price)<Number(a.discount_price):null,u=1==a.promotion_type&&s?t.$util.img("upload/uniapp/index/VIP.png"):null,l=1!=a.promotion_type||s?null:t.$util.img("upload/uniapp/index/discount.png"),h=1!=a.promotion_type?t.$lang("common.currencySymbol"):null,d=1!=a.promotion_type?Number(a.member_price):null,m=1!=a.promotion_type&&d>0?t.$util.img("upload/uniapp/index/VIP.png"):null,f=t.initNum(a);return{$orig:i,g1:n,l0:o,m2:c,m3:r,m4:s,g3:u,g4:l,m5:h,m6:d,g5:m,m7:f}}));return{$orig:i,g0:n,m0:o,m1:c,m8:r,l1:s}})):null),i=t.hasData?t.invalidGoods.length:null,n=t.hasData&&i?t.invalidGoods.length:null,o=t.hasData&&i?t.__map(t.invalidGoods,(function(a,e){var i=t.__get_orig(a),n=t.$util.img(a.sku_image,{size:"mid"}),o=a.sku_spec_format?t.__map(a.sku_spec_format,(function(e,i){var n=t.__get_orig(e),o=a.sku_spec_format.length;return{$orig:n,g9:o}})):null,c=t.$lang("common.currencySymbol");return{$orig:i,g8:n,l3:o,m9:c}})):null,c=t.hasData?null:t.$util.img("upload/uniapp/common-empty.png"),r=t.hasData?null:t.$lang("emptyTips"),s=t.hasData?t.$lang("allElection"):null,u=t.hasData?t.$lang("total"):null,l=t.hasData?t.$lang("common.currencySymbol"):null,h=t.hasData&&t.isAction?t.$lang("del"):null,d=t.hasData&&!t.isAction&&0!=t.totalCount?t.$lang("settlement"):null,m=t.hasData&&!t.isAction&&0==t.totalCount?t.$lang("settlement"):null;t._isMounted||(t.e0=function(a){return t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),t.$mp.data=Object.assign({},{$root:{l2:e,g6:i,g7:n,l4:o,g10:c,m10:r,m11:s,m12:u,m13:l,m14:h,m15:d,m16:m}})},o=[]},cc1f:function(t,a,e){"use strict";var i=e("06c8"),n=e.n(i);n.a}},[["2f5f","common/runtime","common/vendor"]]]);