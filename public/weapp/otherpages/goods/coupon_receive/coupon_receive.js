(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["otherpages/goods/coupon_receive/coupon_receive"],{1490:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return i}));var i={loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,"5203"))},nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,"3584"))}},o=function(){var e=this.$createElement,t=(this._self._c,this.$util.img(this.path)),n=0==this.info.validity_type?this.$util.timeStampTurnTime(this.info.end_time):null;this.$mp.data=Object.assign({},{$root:{g0:t,g1:n}})},c=[]},"21cb":function(e,t,n){},"5fda":function(e,t,n){},6984:function(e,t,n){"use strict";n.r(t);var i=n("caa5"),o=n.n(i);for(var c in i)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(c);t["default"]=o.a},"841a":function(e,t,n){"use strict";(function(e,t){var i=n("4ea4");n("3a80");i(n("66fd"));var o=i(n("bece"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},a137:function(e,t,n){"use strict";var i=n("21cb"),o=n.n(i);o.a},b01a:function(e,t,n){"use strict";var i=n("5fda"),o=n.n(i);o.a},bece:function(e,t,n){"use strict";n.r(t);var i=n("1490"),o=n("6984");for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);n("b01a"),n("a137");var u=n("f0c5"),s=Object(u["a"])(o["default"],i["b"],i["c"],!1,null,"30bd2e96",null,!1,i["a"],void 0);t["default"]=s.exports},caa5:function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("0f13")),c={data:function(){return{info:{},couponTypeId:0,path:"",button:"领取",uid:0,couponBtnSwitch:!1,memberId:0,receivedNum:0}},mixins:[o.default],onLoad:function(t){var n=this;this.$store.dispatch("getAddonIsexit").then((function(t){if(t.coupon){if(t.suid&&e.setStorageSync("suid",t.suid),t.coupon_type_id&&(n.couponTypeId=t.coupon_type_id),t.scene){var i=decodeURIComponent(t.scene);i=i.split("&"),i.length&&i.forEach((function(e){-1!=e.indexOf("coupon_type_id")&&(n.couponTypeId=e.split("-")[1]),-1!=e.indexOf("suid")&&(n.suid=e.split("-")[1])}))}}else n.$util.showToast({title:"优惠券未启用",mask:!0}),setTimeout((function(){n.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),1e3)}))},onShow:function(){this.$langConfig.refresh(),this.getCoupon(),this.receivedNum=0,e.getStorageSync("token")&&(this.getMemberId(),this.getReceivedNum())},onHide:function(){this.couponBtnSwitch=!1},methods:{getCoupon:function(){var t=this;this.$api.sendRequest({url:"/coupon/api/coupon/typeinfo",data:{coupon_type_id:this.couponTypeId},success:function(n){var i=n.data;i?(t.info=i,t.path=i.qrcode,t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.buttonRefresh()):(t.$util.showToast({title:n.message}),setTimeout((function(){e.navigateBack({delta:1})}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})},receiveGoodsCoupon:function(t){var n=this;e.getStorageSync("token")?this.isCanReceive&&(this.couponBtnSwitch||(this.couponBtnSwitch=!0,this.$api.sendRequest({url:"/coupon/api/coupon/receive",data:{coupon_type_id:t,site_id:this.info.site_id,get_type:2},success:function(e){e.data;var t=e.message;0==e.code&&(t="领取成功",n.receivedNum+=1,n.buttonRefresh()),n.$util.showToast({title:t}),n.couponBtnSwitch=!1},fail:function(e){n.couponBtnSwitch=!1}}))):this.$refs.login.open("/otherpages/goods/coupon_receive/coupon_receive?coupon_type_id="+this.couponTypeId)},getMemberId:function(){var e=this;this.$api.sendRequest({url:"/api/member/id",success:function(t){t.code>=0&&(e.memberId=t.data)}})},getReceivedNum:function(){var e=this;this.$api.sendRequest({url:"/coupon/api/coupon/receivedNum",data:{coupon_type_id:this.couponTypeId},success:function(t){t.code>=0&&(e.receivedNum=t.data,e.buttonRefresh())}})},buttonRefresh:function(){this.button="领取",this.info.count==this.info.lead_count?this.button="来迟了该优惠券已被领取完了":0==this.info.max_fetch||0==this.receivedNum||this.info.max_fetch>this.receivedNum?this.button="领取":this.button="该优惠券领取已达到上限"}},computed:{isCanReceive:{get:function(){return this.info.count!=this.info.lead_count&&(0==this.info.max_fetch||0==this.receivedNum||this.info.max_fetch>this.receivedNum)}}},onShareAppMessage:function(e){var t="恭喜您获得一张"+this.info.money+"元的优惠券";1==this.info.range_type?t+=",满".concat(this.info.at_least,"全场可用"):t+=",满".concat(this.info.at_least,"部分商品可用");var n="/otherpages/goods/coupon_receive/coupon_receive?coupon_type_id="+this.couponTypeId;return this.memberId&&(n+="&suid="+this.memberId),{title:t,path:n,success:function(e){},fail:function(e){}}}};t.default=c}).call(this,n("543d")["default"])}},[["841a","common/runtime","common/vendor"]]]);