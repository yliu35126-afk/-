<!--pages/share-guide/share-guide.wxml-->
<!-- 完整复制原来的全屏分享引导 -->
<view class="fullscreen-share-guide show" bindtap="goBack">
  <view class="fullscreen-guide-content" catchtap="preventClose">
    <!-- 顶部安全区域占位 -->
    <view class="safe-area-top"></view>
    
    <!-- 背景装饰 -->
    <view class="guide-bg-decoration"></view>
    
    <!-- 关闭按钮 -->
    <view class="guide-close-btn" bindtap="goBack">✕</view>
    
    <!-- 主标题 -->
    <view class="guide-main-title">
      <!-- 优先显示API返回的分享标题 -->
      <block wx:if="{{shareContent && shareContent.share_title}}">
        {{shareContent.share_title}}
      </block>
      <!-- 回退到默认标题 -->
      <block wx:elif="{{isWinning}}">🎉 恭喜中奖！</block>
      <block wx:else>🎊 分享朋友圈</block>
    </view>
    <view class="guide-sub-title">
      <!-- 优先显示API返回的分享文案 -->
      <block wx:if="{{shareContent && shareContent.share_text}}">
        {{shareContent.share_text}}
      </block>
      <!-- 回退到默认副标题 -->
      <block wx:elif="{{isWinning}}">分享朋友圈 让更多人看到你的好运气</block>
      <block wx:else>分享支付成功 获得更多奖励机会</block>
    </view>
    
    <!-- 分享媒体内容展示 -->
    <view class="guide-media-preview" wx:if="{{shareContent && shareContent.share_media_url}}">
      <view class="media-label">📱 分享内容预览</view>
      <view class="media-container">
        <!-- 加载状态 -->
        <view class="media-loading" wx:if="{{loading}}">
          <view class="loading-spinner"></view>
          <text class="loading-text">加载中...</text>
        </view>
        
        <!-- 视频播放器 -->
        <block wx:if="{{!loading && shareContent.media_type === 'video'}}">
          <video 
            id="shareVideo"
            class="share-video"
            src="{{shareContent.share_media_url}}" 
            controls 
            autoplay="{{true}}"
            loop="{{true}}"
            muted="{{false}}"
            show-center-play-btn="{{true}}"
            show-play-btn="{{true}}"
            bindloadstart="onVideoLoadStart"
            bindloadedmetadata="onVideoLoadedMeta"
            bindcanplay="onVideoCanPlay"
            bindtimeupdate="onVideoTimeUpdate"
            bindwaiting="onVideoWaiting"
            bindprogress="onVideoProgress"
            show-fullscreen-btn="{{false}}"
            show-progress="{{true}}"
            enable-progress-gesture="{{true}}"
            object-fit="contain"
            poster=""
            binderror="onVideoError"
            bindplay="onVideoPlay"
            bindpause="onVideoPause"
            bindended="onVideoEnded"
          ></video>
          <view class="media-type-tag">🎬 视频 (弹窗时自动播放)</view>
          <!-- 视频控制按钮 -->
          <view class="video-controls" style="display: flex; gap: 10rpx; margin-top: 10rpx; justify-content: center;">
            <button class="video-control-btn" bindtap="playShareVideo" 
                    style="font-size: 24rpx; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 20rpx; padding: 8rpx 16rpx;">
              ▶️ 播放
            </button>
            <button class="video-control-btn" bindtap="toggleVideoMute" 
                    style="font-size: 24rpx; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 20rpx; padding: 8rpx 16rpx;">
              🔇 静音
            </button>
          </view>
        </block>
        
        <!-- 图片展示 -->
        <block wx:elif="{{!loading && shareContent.media_type === 'image'}}">
          <image 
            class="share-image-media" 
            src="{{shareContent.share_media_url}}" 
            mode="aspectFit"
            lazy-load="{{true}}"
          ></image>
          <view class="media-type-tag">📷 图片</view>
        </block>
      </view>
      <view class="media-desc">这是朋友们在朋友圈看到的内容</view>
    </view>
    
    <!-- 分享步骤 -->
    <view class="guide-steps">
      <view class="guide-step">
        <view class="step-number">1</view>
        <view class="step-content">
          <view class="step-title">点击右上角 ••• 按钮</view>
          <view class="step-desc">点击页面右上角的三个点按钮</view>
        </view>
        <view class="step-arrow">→</view>
      </view>
      
      <view class="guide-step">
        <view class="step-number">2</view>
        <view class="step-content">
          <view class="step-title">选择"分享到朋友圈"</view>
          <view class="step-desc">在弹出的菜单中选择分享到朋友圈</view>
        </view>
        <view class="step-arrow">→</view>
      </view>
      
      <view class="guide-step">
        <view class="step-number">3</view>
        <view class="step-content">
          <view class="step-title">添加文字发布</view>
          <view class="step-desc">配上推荐文案，让朋友们看到你的好运气</view>
        </view>
      </view>
    </view>
    
    <!-- 右上角箭头指示 -->
    <view class="top-right-indicator">
      <view class="indicator-arrow">↗</view>
      <view class="indicator-text">点击这里分享</view>
    </view>
    
    <!-- 推荐文案 -->
    <view class="guide-recommend-text">
      <view class="recommend-label">💡 推荐文案</view>
      <view class="recommend-content">
        <!-- 优先使用后台API返回的推荐文案 -->
        <block wx:if="{{shareContent && shareContent.recommend_text}}">
          {{shareContent.recommend_text}}
        </block>
        <!-- 如果后台API没有推荐文案，先使用分享标题 -->
        <block wx:elif="{{shareContent && shareContent.share_title}}">
          {{shareContent.share_title}}
        </block>
        <!-- 再回退到分享正文 -->
        <block wx:elif="{{shareContent && shareContent.share_text}}">
          {{shareContent.share_text}}
        </block>
        <!-- 回退到默认文案 -->
        <block wx:elif="{{isWinning && prizeName}}">
          🎊刚参与了异企趣玩抽奖活动，支付¥{{amount}}就有机会获得大奖！我竟然中了{{prizeName}}！运气不错的话说不定你也能中大奖呢～有兴趣的朋友可以一起来试试！
        </block>
        <block wx:else>
          🎊刚参与了异企趣玩抽奖活动，支付¥{{amount}}就有机会获得大奖！快来一起试试运气吧！
        </block>
      </view>
    </view>
    
    <!-- 操作按钮 -->
    <view class="guide-actions">
      <button class="guide-share-btn" bindtap="triggerShare">立即分享到朋友圈</button>
      <button class="guide-copy-btn" bindtap="copyRecommendText">复制推荐文案</button>
      <button class="guide-done-btn" bindtap="goBack">我知道了</button>
    </view>
  </view>
</view>