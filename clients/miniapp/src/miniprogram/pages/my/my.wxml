<!--my.wxml-->
<navigation-bar title="å¼‚ä¼è¶£ç©" back="{{true}}" color="black" background="white"></navigation-bar>
<view class="my-container">
  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- ç™»å½•å¡ç‰‡ -->
    <view class="login-card" bindtap="{{isLoggedIn ? 'goToProfile' : 'handleLogin'}}">
      <view wx:if="{{isLoggedIn && userInfo}}" class="user-info">
        <image wx:if="{{userInfo.avatarUrl}}" class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view wx:else class="user-avatar-placeholder">
          <text class="avatar-text">{{userInfo.nickName ? userInfo.nickName.charAt(0) : 'ç”¨'}}</text>
        </view>
        <text class="user-name">{{userInfo.nickName || 'å¾®ä¿¡ç”¨æˆ·'}}</text>
        <text class="edit-hint">ç‚¹å‡»è®¾ç½®</text>
      </view>
      <view wx:else class="login-prompt">
        <view class="login-icon">
          <text class="icon-text">å±±</text>
        </view>
        <text class="login-text">è¯·ç™»å½•</text>
      </view>
    </view>
    
    <!-- èœå•åˆ—è¡¨ -->
    <view class="menu-list">
      <!-- è®¢å•è®°å½• -->
      <view class="menu-item" bindtap="goToOrders">
        <view class="menu-left">
          <view class="menu-icon order-icon"></view>
          <text class="menu-text">è®¢å•è®°å½•</text>
        </view>
        <view class="arrow-icon"></view>
      </view>

      <!-- å•†å®¶æ ¸é”€ -->
      <view class="menu-item" bindtap="goToMerchantVerification">
        <view class="menu-left">
          <view class="menu-icon verify-icon"></view>
          <text class="menu-text">å•†å®¶æ ¸é”€</text>
        </view>
        <view class="arrow-icon"></view>
      </view>

      <!-- æç°è®°å½• -->
      <view class="menu-item" bindtap="openWithdrawRecords">
        <view class="menu-left">
          <view class="menu-icon withdraw-icon"></view>
          <text class="menu-text">æç°è®°å½•</text>
        </view>
        <view class="arrow-icon"></view>
      </view>
      
      <!-- ç”¨æˆ·åè®® -->
      <view class="menu-item" bindtap="goToAgreement">
        <view class="menu-left">
          <view class="menu-icon agreement-icon"></view>
          <text class="menu-text">ç”¨æˆ·åè®®</text>
        </view>
        <view class="arrow-icon"></view>
      </view>

      <!-- ç¯å¢ƒè®¾ç½®å…¥å£å·²ç§»é™¤ï¼ˆå®¡æ ¸è¦æ±‚ï¼‰ -->
    </view>
  </view>
</view>

<!-- æç°è®°å½•å¼¹çª— -->
<view class="withdraw-modal {{showWithdrawModal ? 'show' : ''}}" catchtap="closeWithdrawModal">
  <view class="withdraw-modal-content" catchtap="preventClose">
    <!-- å¤´éƒ¨ -->
    <view class="withdraw-header">
      <text class="withdraw-title">æç°è®°å½•</text>
      <text class="withdraw-close" catchtap="closeWithdrawModal">âœ•</text>
    </view>
    
    <!-- å†…å®¹åŒºåŸŸ -->
    <view class="withdraw-content">
      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{withdrawLoading}}" class="withdraw-loading">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      
      <!-- æç°è®°å½•åˆ—è¡¨ -->
      <view wx:elif="{{withdrawRecords.length > 0}}" class="withdraw-list">
        <view wx:for="{{withdrawRecords}}" wx:key="index" class="withdraw-item">
          <view class="withdraw-item-header">
            <text class="withdraw-amount">Â¥{{item.amount || '0.00'}}</text>
            <text class="withdraw-status {{ item.status === 'WAIT_USER_CONFIRM' ? 'pending' : (item.status === 'SUCCESS' ? 'success' : (item.status === 'PENDING' ? 'pending' : (item.status === 'CANCELLED' ? 'cancelled' : 'failed'))) }}">
              {{ item.status_text || (item.status === 'WAIT_USER_CONFIRM' ? 'å¾…ç¡®è®¤' : (item.status === 'SUCCESS' ? 'å·²åˆ°è´¦' : (item.status === 'PENDING' ? 'å¤„ç†ä¸­' : (item.status === 'CANCELLED' ? 'å·²å–æ¶ˆ' : 'å¤±è´¥')))) }}
            </text>
          </view>
          
          <view class="withdraw-item-info">
            <text class="withdraw-time">{{item.create_time}}</text>
            <text class="withdraw-id">æç°å•å·ï¼š{{item.withdraw_id}}</text>
            <text class="withdraw-trade" wx:if="{{item.trade_no}}">äº¤æ˜“å·ï¼š{{item.trade_no}}</text>

            <!-- æœªå®ŒæˆåŸå› å±•ç¤ºï¼ˆåŸâ€œå¤±è´¥åŸå› â€ï¼‰ -->
            <text class="withdraw-reason" wx:if="{{item.status === 'FAILED' && (item.fail_reason || item.remark)}}">
              æœªå®ŒæˆåŸå› ï¼š{{item.fail_reason || item.remark}}
            </text>
            <!-- å¾…ç¡®è®¤æç¤º -->
            <text class="withdraw-tip" wx:if="{{item.status === 'WAIT_USER_CONFIRM'}}">
              è¯·åœ¨å¾®ä¿¡å¼¹çª—ä¸­ç¡®è®¤æ”¶æ¬¾ï¼Œ24å°æ—¶å†…æœªç¡®è®¤å°†è‡ªåŠ¨å…³é—­
            </text>

          </view>
          
          <!-- ç¡®è®¤æ”¶æ¬¾æŒ‰é’® -->
          <view wx:if="{{item.status === 'WAIT_USER_CONFIRM' && item.package_info}}" class="withdraw-actions">
            <button class="confirm-btn" 
                    bindtap="confirmWithdraw" 
                    data-record="{{item}}">
              ç¡®è®¤æ”¶æ¬¾
            </button>
          </view>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:else class="withdraw-empty">
        <text class="empty-text">æš‚æ— æç°è®°å½•</text>
      </view>
    </view>
  </view>
</view>

<!-- è½¬è´¦ç¡®è®¤å¼¹çª— -->
<view class="transfer-modal {{showTransferModal ? 'show' : ''}}" catchtap="closeTransferModal">
  <view class="transfer-modal-content" catchtap="preventClose">
    <!-- å¤´éƒ¨å›¾æ ‡ -->
    <view class="transfer-header">
      <view class="transfer-icon">ğŸ’°</view>
      <view class="transfer-title">ç¡®è®¤æ”¶æ¬¾</view>
    </view>
    
    <!-- è½¬è´¦ä¿¡æ¯ -->
    <view class="transfer-info">
      <view class="transfer-amount">Â¥{{currentTransfer.amount || '0.00'}}</view>
      <view class="transfer-message">
        è½¬è´¦ç”³è¯·æˆåŠŸï¼è¯·ç¡®è®¤æ”¶æ¬¾åˆ°å¾®ä¿¡é›¶é’±
      </view>
      <view class="transfer-tip">
        24å°æ—¶å†…æœªç¡®è®¤å°†è‡ªåŠ¨å…³é—­
      </view>
    </view>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="transfer-actions">
      <button class="transfer-confirm-btn" 
              bindtap="doConfirmTransfer" 
              loading="{{transferLoading}}"
              disabled="{{transferLoading}}">
        {{transferLoading ? 'ç¡®è®¤ä¸­...' : 'ç¡®è®¤æ”¶æ¬¾'}}
      </button>
      <button class="transfer-cancel-btn" 
              bindtap="closeTransferModal"
              disabled="{{transferLoading}}">
        ç¨åå¤„ç†
      </button>
    </view>
  </view>
</view>
